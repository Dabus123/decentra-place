"use strict";(self.webpackChunkan_onchain_app_in_100_components=self.webpackChunkan_onchain_app_in_100_components||[]).push([[7033],{"./node_modules/@thirdweb-dev/sdk/dist/contract-appuri-5c40af52.browser.esm.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{C:()=>ContractMetadata,G:()=>GasCostEstimator,a:()=>ContractEvents,b:()=>ContractAppURI,d:()=>detectContractFeature,h:()=>hasFunction});var _index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@thirdweb-dev/sdk/dist/index-33cd3415.browser.esm.js"),_transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@thirdweb-dev/sdk/dist/transactions-72f9603c.browser.esm.js"),ethers__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@ethersproject/units/lib.esm/index.js"),_thirdweb_dev_storage__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@thirdweb-dev/storage/dist/thirdweb-dev-storage.esm.js"),console=__webpack_require__("./node_modules/console-browserify/index.js");function detectContractFeature(contractWrapper,featureName){return(0,_index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_0__.ai)(contractWrapper.abi,featureName,contractWrapper.extensions)}function hasFunction(functionName,contractWrapper){return functionName in contractWrapper.readContract.functions}class ContractMetadata{featureName=_index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_0__.cJ.name;constructor(contractWrapper,schema,storage){this.contractWrapper=contractWrapper,this.schema=schema,this.storage=storage}parseOutputMetadata(metadata){return this.schema.output.parseAsync(metadata)}parseInputMetadata(metadata){return this.schema.input.parseAsync(metadata)}async get(){let data;if(this.supportsContractMetadata(this.contractWrapper)){const uri=await this.contractWrapper.read("contractURI",[]);uri&&uri.includes("://")&&(data=await this.storage.downloadJSON(uri))}if(!data)try{let contractName,contractSymbol,publishedMetadata;try{hasFunction("name",this.contractWrapper)&&(contractName=await this.contractWrapper.read("name",[]))}catch(err){}try{hasFunction("symbol",this.contractWrapper)&&(contractSymbol=await this.contractWrapper.read("symbol",[]))}catch(err){}try{publishedMetadata=await(0,_index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_0__.K)(this.contractWrapper.address,this.contractWrapper.getProvider(),this.storage,this.contractWrapper.options)}catch(err){}data={name:contractName||publishedMetadata?.name,symbol:contractSymbol,description:publishedMetadata?.info.title}}catch(e){throw new Error("Could not fetch contract metadata")}return this.parseOutputMetadata(data)}set=(0,_transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.f)((async metadata=>{const uri=await this._parseAndUploadMetadata(metadata),wrapper=this.contractWrapper;if(this.supportsContractMetadata(wrapper))return _transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"setContractURI",args:[uri],parse:receipt=>({receipt,data:this.get})});throw new _index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_0__.x(_index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_0__.cJ)}));update=(0,_transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.f)((async metadata=>await this.set.prepare({...await this.get(),...metadata})));async _parseAndUploadMetadata(metadata){const parsedMetadata=await this.parseInputMetadata(metadata);return this.storage.upload(parsedMetadata)}supportsContractMetadata(contractWrapper){return detectContractFeature(contractWrapper,"ContractMetadata")}}class ContractEvents{constructor(contractWrapper){this.contractWrapper=contractWrapper}addTransactionListener(listener){this.contractWrapper.addListener(_index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_0__.aZ.Transaction,listener)}removeTransactionListener(listener){this.contractWrapper.off(_index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_0__.aZ.Transaction,listener)}addEventListener(eventName,listener){const event=this.contractWrapper.readContract.interface.getEvent(eventName),filter={address:this.contractWrapper.address,topics:[this.contractWrapper.readContract.interface.getEventTopic(event)]},wrappedListener=log=>{const parsedLog=this.contractWrapper.readContract.interface.parseLog(log);listener(this.toContractEvent(parsedLog.eventFragment,parsedLog.args,log))};return this.contractWrapper.getProvider().on(filter,wrappedListener),()=>{this.contractWrapper.getProvider().off(filter,wrappedListener)}}listenToAllEvents(listener){const filter={address:this.contractWrapper.address},wrappedListener=log=>{try{const parsedLog=this.contractWrapper.readContract.interface.parseLog(log);listener(this.toContractEvent(parsedLog.eventFragment,parsedLog.args,log))}catch(e){console.error("Could not parse event:",log,e)}};return this.contractWrapper.getProvider().on(filter,wrappedListener),()=>{this.contractWrapper.getProvider().off(filter,wrappedListener)}}removeEventListener(eventName,listener){const event=this.contractWrapper.readContract.interface.getEvent(eventName);this.contractWrapper.readContract.off(event.name,listener)}removeAllListeners(){this.contractWrapper.readContract.removeAllListeners();const filter={address:this.contractWrapper.address};this.contractWrapper.getProvider().removeAllListeners(filter)}async getAllEvents(){let filters=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{fromBlock:0,toBlock:"latest",order:"desc"};const orderedEvents=(await this.contractWrapper.readContract.queryFilter({},filters.fromBlock,filters.toBlock)).sort(((a,b)=>"desc"===filters.order?b.blockNumber-a.blockNumber:a.blockNumber-b.blockNumber));return this.parseEvents(orderedEvents)}async getEvents(eventName){let options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{fromBlock:0,toBlock:"latest",order:"desc"};const eventInterface=this.contractWrapper.readContract.interface.getEvent(eventName),args=options.filters?eventInterface.inputs.map((e=>options.filters[e.name])):[],filter=this.contractWrapper.readContract.filters[eventInterface.name](...args),orderedEvents=(await this.contractWrapper.readContract.queryFilter(filter,options.fromBlock,options.toBlock)).sort(((a,b)=>"desc"===options.order?b.blockNumber-a.blockNumber:a.blockNumber-b.blockNumber));return this.parseEvents(orderedEvents)}parseEvents(events){return events.map((e=>{const transaction=Object.fromEntries(Object.entries(e).filter((a=>"function"!=typeof a[1]&&"args"!==a[0])));if(e.args){const entries=Object.entries(e.args),args=entries.slice(entries.length/2,entries.length),data={};for(const[key,value]of args)data[key]=value;return{eventName:e.event||"",data,transaction}}return{eventName:e.event||"",data:{},transaction}}))}toContractEvent(event,args,rawLog){const transaction=Object.fromEntries(Object.entries(rawLog).filter((a=>"function"!=typeof a[1]&&"args"!==a[0]))),results={};return event.inputs.forEach(((param,index)=>{if(Array.isArray(args[index])){const components=param.components;if(components){const arr=args[index];if("tuple[]"===param.type){const objArray=[];for(let i=0;i<arr.length;i++){const tuple=arr[i],obj={};for(let j=0;j<components.length;j++){obj[components[j].name]=tuple[j]}objArray.push(obj)}results[param.name]=objArray}else{const obj={};for(let i=0;i<components.length;i++){obj[components[i].name]=arr[i]}results[param.name]=obj}}}else results[param.name]=args[index]})),{eventName:event.name,data:results,transaction}}}class GasCostEstimator{constructor(contractWrapper){this.contractWrapper=contractWrapper}async gasCostOf(fn,args){return function toEther(amount){return ethers__WEBPACK_IMPORTED_MODULE_2__.formatEther(amount)}(await(0,_transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.c)(this.contractWrapper.getProvider(),await this.contractWrapper.populateTransaction(fn,args)))}async gasLimitOf(fn,args){return this.contractWrapper.estimateGas(fn,args)}async currentGasPriceInGwei(){const price=await this.contractWrapper.getProvider().getGasPrice();return ethers__WEBPACK_IMPORTED_MODULE_2__.formatUnits(price,"gwei")}}class ContractAppURI{featureName=_index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_0__.cK.name;constructor(contractWrapper,metadata,storage){this.contractWrapper=contractWrapper,this.metadata=metadata,this.storage=storage}async get(){return detectContractFeature(this.contractWrapper,"AppURI")?await this.contractWrapper.read("appURI",[]):(0,_thirdweb_dev_storage__WEBPACK_IMPORTED_MODULE_3__.Rz)((await this.metadata.get()).app_uri||"",this.storage.getGatewayUrls())}set=(0,_transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.f)((async appURI=>detectContractFeature(this.contractWrapper,"AppURI")?_transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"setAppURI",args:[appURI]}):await this.metadata.update.prepare({app_uri:appURI})))}},"./node_modules/@thirdweb-dev/sdk/dist/contract-interceptor-d7b164a7.browser.esm.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{C:()=>ContractInterceptor});class ContractInterceptor{constructor(contractWrapper){this.contractWrapper=contractWrapper}overrideNextTransaction(hook){this.contractWrapper.withTransactionOverride(hook)}}},"./node_modules/@thirdweb-dev/sdk/dist/vote-e5646e80.browser.esm.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Vote:()=>Vote});var bignumber=__webpack_require__("./node_modules/@ethersproject/bignumber/lib.esm/bignumber.js"),id=__webpack_require__("./node_modules/@ethersproject/hash/lib.esm/id.js"),lib_esm=__webpack_require__("./node_modules/@ethersproject/units/lib.esm/index.js"),contracts_lib_esm=__webpack_require__("./node_modules/@ethersproject/contracts/lib.esm/index.js"),fetchCurrencyValue_32d08b05_browser_esm=__webpack_require__("./node_modules/@thirdweb-dev/sdk/dist/fetchCurrencyValue-32d08b05.browser.esm.js"),index_33cd3415_browser_esm=__webpack_require__("./node_modules/@thirdweb-dev/sdk/dist/index-33cd3415.browser.esm.js"),transactions_72f9603c_browser_esm=__webpack_require__("./node_modules/@thirdweb-dev/sdk/dist/transactions-72f9603c.browser.esm.js"),contract_appuri_5c40af52_browser_esm=__webpack_require__("./node_modules/@thirdweb-dev/sdk/dist/contract-appuri-5c40af52.browser.esm.js"),contract_interceptor_d7b164a7_browser_esm=__webpack_require__("./node_modules/@thirdweb-dev/sdk/dist/contract-interceptor-d7b164a7.browser.esm.js");let VoteType=function(VoteType){return VoteType[VoteType.Against=0]="Against",VoteType[VoteType.For=1]="For",VoteType[VoteType.Abstain=2]="Abstain",VoteType}({});__webpack_require__("./node_modules/bn.js/lib/bn.js"),__webpack_require__("./node_modules/bs58/index.js"),__webpack_require__("./node_modules/eventemitter3/index.mjs");class Vote{get chainId(){return this._chainId}constructor(network,address,storage){let options=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},abi=arguments.length>4?arguments[4]:void 0,chainId=arguments.length>5?arguments[5]:void 0,contractWrapper=arguments.length>6&&void 0!==arguments[6]?arguments[6]:new index_33cd3415_browser_esm.cs(network,address,abi,options,storage);this._chainId=chainId,this.abi=index_33cd3415_browser_esm.bj.parse(abi||[]),this.contractWrapper=contractWrapper,this.storage=storage,this.metadata=new contract_appuri_5c40af52_browser_esm.C(this.contractWrapper,index_33cd3415_browser_esm.cp,this.storage),this.app=new contract_appuri_5c40af52_browser_esm.b(this.contractWrapper,this.metadata,this.storage),this.encoder=new fetchCurrencyValue_32d08b05_browser_esm.C(this.contractWrapper),this.estimator=new contract_appuri_5c40af52_browser_esm.G(this.contractWrapper),this.events=new contract_appuri_5c40af52_browser_esm.a(this.contractWrapper),this.interceptor=new contract_interceptor_d7b164a7_browser_esm.C(this.contractWrapper)}onNetworkUpdated(network){this.contractWrapper.updateSignerOrProvider(network)}getAddress(){return this.contractWrapper.address}async get(proposalId){const proposals=(await this.getAll()).filter((p=>p.proposalId.eq(bignumber.gH.from(proposalId))));if(0===proposals.length)throw new Error("proposal not found");return proposals[0]}async getAll(){const _proposals=await this.contractWrapper.read("getAllProposals",[])??[];return(await Promise.all(_proposals.map((item=>Promise.all([this.contractWrapper.read("state",[item.proposalId]),this.getProposalVotes(item.proposalId)]))))).map(((_ref,index)=>{let[state,votes]=_ref;const data=_proposals[index];return{proposalId:data.proposalId,proposer:data.proposer,description:data.description,startBlock:data.startBlock,endBlock:data.endBlock,state,votes,executions:data[3].map(((c,i)=>({toAddress:data.targets[i],nativeTokenValue:c,transactionData:data.calldatas[i]})))}}))}async getProposalVotes(proposalId){const votes=await this.contractWrapper.read("proposalVotes",[proposalId]);return[{type:VoteType.Against,label:"Against",count:votes.againstVotes},{type:VoteType.For,label:"For",count:votes.forVotes},{type:VoteType.Abstain,label:"Abstain",count:votes.abstainVotes}]}async hasVoted(proposalId,account){return account||(account=await this.contractWrapper.getSignerAddress()),this.contractWrapper.read("hasVoted",[proposalId,await(0,index_33cd3415_browser_esm.aL)(account)])}async canExecute(proposalId){await this.ensureExists(proposalId);const proposal=await this.get(proposalId),tos=proposal.executions.map((p=>p.toAddress)),values=proposal.executions.map((p=>p.nativeTokenValue)),datas=proposal.executions.map((p=>p.transactionData)),descriptionHash=id.id(proposal.description);try{return await this.contractWrapper.callStatic().execute(tos,values,datas,descriptionHash),!0}catch(e){return!1}}async balance(){const balance=await this.contractWrapper.getProvider().getBalance(this.contractWrapper.address);return{name:"",symbol:"",decimals:18,value:balance,displayValue:lib_esm.formatUnits(balance,18)}}async balanceOfToken(tokenAddress){const ERC20Abi=(await Promise.resolve().then(__webpack_require__.t.bind(__webpack_require__,"./node_modules/@thirdweb-dev/contracts-js/dist/abis/IERC20.json",19))).default,erc20=new contracts_lib_esm.NZ(await(0,index_33cd3415_browser_esm.aL)(tokenAddress),ERC20Abi,this.contractWrapper.getProvider());return await(0,fetchCurrencyValue_32d08b05_browser_esm.a)(this.contractWrapper.getProvider(),tokenAddress,await erc20.balanceOf(this.contractWrapper.address))}async ensureExists(proposalId){try{await this.contractWrapper.read("state",[proposalId])}catch(e){throw Error(`Proposal ${proposalId} not found`)}}async settings(){const[votingDelay,votingPeriod,votingTokenAddress,votingQuorumFraction,proposalTokenThreshold]=await Promise.all([this.contractWrapper.read("votingDelay",[]),this.contractWrapper.read("votingPeriod",[]),this.contractWrapper.read("token",[]),this.contractWrapper.read("quorumNumerator",[]),this.contractWrapper.read("proposalThreshold",[])]),votingTokenMetadata=await(0,fetchCurrencyValue_32d08b05_browser_esm.f)(this.contractWrapper.getProvider(),votingTokenAddress);return{votingDelay:votingDelay.toString(),votingPeriod:votingPeriod.toString(),votingTokenAddress,votingTokenMetadata,votingQuorumFraction:votingQuorumFraction.toString(),proposalTokenThreshold:proposalTokenThreshold.toString()}}propose=(0,transactions_72f9603c_browser_esm.f)((async(description,executions)=>{executions||(executions=[{toAddress:this.contractWrapper.address,nativeTokenValue:0,transactionData:"0x"}]);const tos=executions.map((p=>p.toAddress)),values=executions.map((p=>p.nativeTokenValue)),datas=executions.map((p=>p.transactionData));return transactions_72f9603c_browser_esm.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"propose",args:[tos,values,datas,description],parse:receipt=>({id:this.contractWrapper.parseLogs("ProposalCreated",receipt?.logs)[0].args.proposalId,receipt})})}));vote=(0,transactions_72f9603c_browser_esm.f)((()=>{var _this=this;return async function(proposalId,voteType){let reason=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return await _this.ensureExists(proposalId),transactions_72f9603c_browser_esm.T.fromContractWrapper({contractWrapper:_this.contractWrapper,method:"castVoteWithReason",args:[proposalId,voteType,reason]})}})());execute=(0,transactions_72f9603c_browser_esm.f)((async proposalId=>{await this.ensureExists(proposalId);const proposal=await this.get(proposalId),tos=proposal.executions.map((p=>p.toAddress)),values=proposal.executions.map((p=>p.nativeTokenValue)),datas=proposal.executions.map((p=>p.transactionData)),descriptionHash=id.id(proposal.description);return transactions_72f9603c_browser_esm.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"execute",args:[tos,values,datas,descriptionHash]})}));async prepare(method,args,overrides){return transactions_72f9603c_browser_esm.T.fromContractWrapper({contractWrapper:this.contractWrapper,method,args,overrides})}async call(functionName,args,overrides){return this.contractWrapper.call(functionName,args,overrides)}}}}]);