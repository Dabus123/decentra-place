"use strict";(self.webpackChunkan_onchain_app_in_100_components=self.webpackChunkan_onchain_app_in_100_components||[]).push([[813],{"./node_modules/@thirdweb-dev/sdk/dist/QueryParams-32a56510.browser.esm.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{D:()=>DEFAULT_QUERY_ALL_COUNT,F:()=>FALLBACK_METADATA,I:()=>InterfaceId_IERC721,a:()=>InterfaceId_IERC1155,b:()=>uploadOrExtractURI,c:()=>fetchTokenMetadataForContract,f:()=>fetchTokenMetadata,g:()=>getBaseUriFromBatch,u:()=>uploadOrExtractURIs});var _setErc20Allowance_7f76f677_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@thirdweb-dev/sdk/dist/setErc20Allowance-7f76f677.browser.esm.js"),ethers__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@ethersproject/bytes/lib.esm/index.js"),ethers__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@ethersproject/bignumber/lib.esm/bignumber.js"),ethers__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@ethersproject/contracts/lib.esm/index.js"),Buffer=__webpack_require__("./node_modules/buffer/index.js").Buffer,console=__webpack_require__("./node_modules/console-browserify/index.js");const InterfaceId_IERC721=(()=>ethers__WEBPACK_IMPORTED_MODULE_0__.arrayify("0x80ac58cd"))(),InterfaceId_IERC1155=(()=>ethers__WEBPACK_IMPORTED_MODULE_0__.arrayify("0xd9b67a26"))(),FALLBACK_METADATA={name:"Failed to load NFT metadata"};async function fetchTokenMetadata(tokenId,tokenUri,storage){if(tokenUri.startsWith("data:application/json;base64")&&void 0!==Buffer){const base64=tokenUri.split(",")[1],jsonMetadata=JSON.parse(Buffer.from(base64,"base64").toString("utf-8"));return _setErc20Allowance_7f76f677_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.a.parse({...jsonMetadata,id:ethers__WEBPACK_IMPORTED_MODULE_2__.gH.from(tokenId).toString(),uri:tokenUri})}const parsedUri=tokenUri.replace("{id}",ethers__WEBPACK_IMPORTED_MODULE_0__.hexZeroPad(ethers__WEBPACK_IMPORTED_MODULE_2__.gH.from(tokenId).toHexString(),32).slice(2));let jsonMetadata;try{jsonMetadata=await storage.downloadJSON(parsedUri)}catch(err){const unparsedTokenIdUri=tokenUri.replace("{id}",ethers__WEBPACK_IMPORTED_MODULE_2__.gH.from(tokenId).toString());try{jsonMetadata=await storage.downloadJSON(unparsedTokenIdUri)}catch(e){console.warn(`failed to get token metadata: ${JSON.stringify({tokenId:tokenId.toString(),tokenUri})} -- falling back to default metadata`),jsonMetadata=FALLBACK_METADATA}}return _setErc20Allowance_7f76f677_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.a.parse({...jsonMetadata,id:ethers__WEBPACK_IMPORTED_MODULE_2__.gH.from(tokenId).toString(),uri:tokenUri})}async function fetchTokenMetadataForContract(contractAddress,provider,tokenId,storage){let uri;const ERC165MetadataAbi=(await __webpack_require__.e(4811).then(__webpack_require__.t.bind(__webpack_require__,"./node_modules/@thirdweb-dev/contracts-js/dist/abis/IERC165.json",19))).default,erc165=new ethers__WEBPACK_IMPORTED_MODULE_3__.NZ(contractAddress,ERC165MetadataAbi,provider),[isERC721,isERC1155]=await Promise.all([erc165.supportsInterface(InterfaceId_IERC721),erc165.supportsInterface(InterfaceId_IERC1155)]);if(isERC721){const ERC721MetadataAbi=(await Promise.resolve().then(__webpack_require__.t.bind(__webpack_require__,"./node_modules/@thirdweb-dev/contracts-js/dist/abis/IERC721Metadata.json",19))).default,erc721=new ethers__WEBPACK_IMPORTED_MODULE_3__.NZ(contractAddress,ERC721MetadataAbi,provider);uri=await erc721.tokenURI(tokenId)}else{if(!isERC1155)throw Error("Contract must implement ERC 1155 or ERC 721.");{const ERC1155MetadataAbi=(await Promise.resolve().then(__webpack_require__.t.bind(__webpack_require__,"./node_modules/@thirdweb-dev/contracts-js/dist/abis/IERC1155Metadata.json",19))).default,erc1155=new ethers__WEBPACK_IMPORTED_MODULE_3__.NZ(contractAddress,ERC1155MetadataAbi,provider);uri=await erc1155.uri(tokenId)}}return uri?fetchTokenMetadata(tokenId,uri,storage):_setErc20Allowance_7f76f677_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.a.parse({...FALLBACK_METADATA,id:ethers__WEBPACK_IMPORTED_MODULE_2__.gH.from(tokenId).toString(),uri:""})}async function uploadOrExtractURI(metadata,storage){return"string"==typeof metadata?metadata:await storage.upload(_setErc20Allowance_7f76f677_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.C.parse(metadata))}async function uploadOrExtractURIs(metadatas,storage,startNumber,options){if(function isUriList(metadatas){return void 0===metadatas.find((m=>"string"!=typeof m))}(metadatas))return metadatas;if(function isMetadataList(metadatas){return void 0===metadatas.find((m=>"object"!=typeof m))}(metadatas)){return await storage.uploadBatch(metadatas.map((m=>_setErc20Allowance_7f76f677_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.C.parse(m))),{rewriteFileNames:{fileStartNumber:startNumber||0},onProgress:options?.onProgress})}throw new Error("NFT metadatas must all be of the same type (all URI or all NFTMetadataInput)")}function getBaseUriFromBatch(uris){const baseUri=uris[0].substring(0,uris[0].lastIndexOf("/"));for(let i=0;i<uris.length;i++){const uri=uris[i].substring(0,uris[i].lastIndexOf("/"));if(baseUri!==uri)throw new Error(`Can only create batches with the same base URI for every entry in the batch. Expected '${baseUri}' but got '${uri}'`)}return baseUri.replace(/\/$/,"")+"/"}const DEFAULT_QUERY_ALL_COUNT=100},"./node_modules/@thirdweb-dev/sdk/dist/cleanCurrencyAddress-ded19cfe.browser.esm.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{c:()=>cleanCurrencyAddress});var _index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@thirdweb-dev/sdk/dist/index-33cd3415.browser.esm.js"),_fetchCurrencyValue_32d08b05_browser_esm_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@thirdweb-dev/sdk/dist/fetchCurrencyValue-32d08b05.browser.esm.js");function cleanCurrencyAddress(currencyAddress){return(0,_fetchCurrencyValue_32d08b05_browser_esm_js__WEBPACK_IMPORTED_MODULE_0__.i)(currencyAddress)?_index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.aV:currencyAddress}},"./node_modules/@thirdweb-dev/sdk/dist/contract-interceptor-d7b164a7.browser.esm.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{C:()=>ContractInterceptor});class ContractInterceptor{constructor(contractWrapper){this.contractWrapper=contractWrapper}overrideNextTransaction(hook){this.contractWrapper.withTransactionOverride(hook)}}},"./node_modules/@thirdweb-dev/sdk/dist/contract-platform-fee-e756e68f.browser.esm.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{C:()=>ContractPlatformFee});var _transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@thirdweb-dev/sdk/dist/transactions-72f9603c.browser.esm.js"),_index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@thirdweb-dev/sdk/dist/index-33cd3415.browser.esm.js");class ContractPlatformFee{featureName=_index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_0__.du.name;constructor(contractWrapper){this.contractWrapper=contractWrapper}async get(){const[platformFeeRecipient,platformFeeBps]=await this.contractWrapper.read("getPlatformFeeInfo",[]);return _index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_0__.bH.parseAsync({platform_fee_recipient:platformFeeRecipient,platform_fee_basis_points:platformFeeBps})}set=(0,_transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.f)((async platformFeeInfo=>{const parsed=await _index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_0__.bH.parseAsync(platformFeeInfo);return _transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"setPlatformFeeInfo",args:[parsed.platform_fee_recipient,parsed.platform_fee_basis_points]})}))}},"./node_modules/@thirdweb-dev/sdk/dist/marketplace-2e2adc0e.browser.esm.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Marketplace:()=>Marketplace});var bignumber=__webpack_require__("./node_modules/@ethersproject/bignumber/lib.esm/bignumber.js"),addresses=__webpack_require__("./node_modules/@ethersproject/constants/lib.esm/addresses.js"),lib_esm=__webpack_require__("./node_modules/@ethersproject/units/lib.esm/index.js"),bignumbers=__webpack_require__("./node_modules/@ethersproject/constants/lib.esm/bignumbers.js"),address_lib_esm=__webpack_require__("./node_modules/@ethersproject/address/lib.esm/index.js"),contracts_lib_esm=__webpack_require__("./node_modules/@ethersproject/contracts/lib.esm/index.js"),tiny_invariant=__webpack_require__("./node_modules/tiny-invariant/dist/esm/tiny-invariant.js"),QueryParams_32a56510_browser_esm=__webpack_require__("./node_modules/@thirdweb-dev/sdk/dist/QueryParams-32a56510.browser.esm.js"),fetchCurrencyValue_32d08b05_browser_esm=__webpack_require__("./node_modules/@thirdweb-dev/sdk/dist/fetchCurrencyValue-32d08b05.browser.esm.js"),index_33cd3415_browser_esm=__webpack_require__("./node_modules/@thirdweb-dev/sdk/dist/index-33cd3415.browser.esm.js"),marketplace_e3129e2f_browser_esm=__webpack_require__("./node_modules/@thirdweb-dev/sdk/dist/marketplace-e3129e2f.browser.esm.js"),transactions_72f9603c_browser_esm=__webpack_require__("./node_modules/@thirdweb-dev/sdk/dist/transactions-72f9603c.browser.esm.js"),contract_appuri_5c40af52_browser_esm=__webpack_require__("./node_modules/@thirdweb-dev/sdk/dist/contract-appuri-5c40af52.browser.esm.js"),contract_interceptor_d7b164a7_browser_esm=__webpack_require__("./node_modules/@thirdweb-dev/sdk/dist/contract-interceptor-d7b164a7.browser.esm.js"),contract_platform_fee_e756e68f_browser_esm=__webpack_require__("./node_modules/@thirdweb-dev/sdk/dist/contract-platform-fee-e756e68f.browser.esm.js"),contract_roles_71988d2e_browser_esm=__webpack_require__("./node_modules/@thirdweb-dev/sdk/dist/contract-roles-71988d2e.browser.esm.js"),cleanCurrencyAddress_ded19cfe_browser_esm=__webpack_require__("./node_modules/@thirdweb-dev/sdk/dist/cleanCurrencyAddress-ded19cfe.browser.esm.js"),normalizePriceValue_9851c0eb_browser_esm=__webpack_require__("./node_modules/@thirdweb-dev/sdk/dist/normalizePriceValue-9851c0eb.browser.esm.js"),setErc20Allowance_7f76f677_browser_esm=__webpack_require__("./node_modules/@thirdweb-dev/sdk/dist/setErc20Allowance-7f76f677.browser.esm.js");let ListingType=function(ListingType){return ListingType[ListingType.Direct=0]="Direct",ListingType[ListingType.Auction=1]="Auction",ListingType}({});__webpack_require__("./node_modules/bn.js/lib/bn.js"),__webpack_require__("./node_modules/bs58/index.js"),__webpack_require__("./node_modules/eventemitter3/index.mjs");var console=__webpack_require__("./node_modules/console-browserify/index.js");class MarketplaceAuction{constructor(contractWrapper,storage){this.contractWrapper=contractWrapper,this.storage=storage,this.encoder=new fetchCurrencyValue_32d08b05_browser_esm.C(contractWrapper)}getAddress(){return this.contractWrapper.address}async getListing(listingId){const listing=await this.contractWrapper.read("listings",[listingId]);if(listing.listingId.toString()!==listingId.toString())throw new index_33cd3415_browser_esm.L(this.getAddress(),listingId.toString());if(listing.listingType!==ListingType.Auction)throw new index_33cd3415_browser_esm.W(this.getAddress(),listingId.toString(),"Direct","Auction");return await this.mapListing(listing)}async getWinningBid(listingId){await this.validateListing(bignumber.gH.from(listingId));const offers=await this.contractWrapper.read("winningBid",[listingId]);if(offers.offeror!==addresses.L)return await(0,marketplace_e3129e2f_browser_esm.m)(this.contractWrapper.getProvider(),bignumber.gH.from(listingId),offers)}async getWinner(listingId){const listing=await this.validateListing(bignumber.gH.from(listingId)),offers=await this.contractWrapper.read("winningBid",[listingId]),now=bignumber.gH.from(Math.floor(Date.now()/1e3)),endTime=bignumber.gH.from(listing.endTimeInEpochSeconds);if(now.gt(endTime)&&offers.offeror!==addresses.L)return offers.offeror;const contractEvents=new contract_appuri_5c40af52_browser_esm.a(this.contractWrapper),auction=(await contractEvents.getEvents("AuctionClosed")).find((a=>a.data.listingId.eq(bignumber.gH.from(listingId))));if(!auction)throw new Error(`Could not find auction with listingId ${listingId} in closed auctions`);return auction.data.winningBidder}createListing=(0,transactions_72f9603c_browser_esm.f)((async listing=>{(0,marketplace_e3129e2f_browser_esm.v)(listing);const resolvedAssetAddress=await(0,index_33cd3415_browser_esm.aL)(listing.assetContractAddress),resolvedCurrencyAddress=await(0,index_33cd3415_browser_esm.aL)(listing.currencyContractAddress);await(0,marketplace_e3129e2f_browser_esm.h)(this.contractWrapper,this.getAddress(),resolvedAssetAddress,listing.tokenId,await this.contractWrapper.getSignerAddress());const normalizedPricePerToken=await(0,normalizePriceValue_9851c0eb_browser_esm.n)(this.contractWrapper.getProvider(),listing.buyoutPricePerToken,resolvedCurrencyAddress),normalizedReservePrice=await(0,normalizePriceValue_9851c0eb_browser_esm.n)(this.contractWrapper.getProvider(),listing.reservePricePerToken,resolvedCurrencyAddress);let listingStartTime=Math.floor(listing.startTimestamp.getTime()/1e3);const blockTime=(await this.contractWrapper.getProvider().getBlock("latest")).timestamp;listingStartTime<blockTime&&(listingStartTime=blockTime);const tx=transactions_72f9603c_browser_esm.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"createListing",args:[{assetContract:resolvedAssetAddress,tokenId:listing.tokenId,buyoutPricePerToken:normalizedPricePerToken,currencyToAccept:(0,cleanCurrencyAddress_ded19cfe_browser_esm.c)(resolvedCurrencyAddress),listingType:ListingType.Auction,quantityToList:listing.quantity,reservePricePerToken:normalizedReservePrice,secondsUntilEndTime:listing.listingDurationInSeconds,startTime:bignumber.gH.from(listingStartTime)}],parse:receipt=>({id:this.contractWrapper.parseLogs("ListingAdded",receipt?.logs)[0].args.listingId,receipt})});return tx.setGasLimitMultiple(1.2),tx}));createListingsBatch=(0,transactions_72f9603c_browser_esm.f)((async listings=>{const data=(await Promise.all(listings.map((listing=>this.createListing.prepare(listing))))).map((tx=>tx.encode())),tx=transactions_72f9603c_browser_esm.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"multicall",args:[data],parse:receipt=>this.contractWrapper.parseLogs("ListingAdded",receipt?.logs).map((event=>({id:event.args.listingId,receipt})))});return tx.setGasLimitMultiple(1.2),tx}));buyoutListing=(0,transactions_72f9603c_browser_esm.f)((async listingId=>{const listing=await this.validateListing(bignumber.gH.from(listingId)),currencyMetadata=await(0,fetchCurrencyValue_32d08b05_browser_esm.f)(this.contractWrapper.getProvider(),listing.currencyContractAddress);return this.makeBid.prepare(listingId,lib_esm.formatUnits(listing.buyoutPrice,currencyMetadata.decimals))}));makeBid=(0,transactions_72f9603c_browser_esm.f)((async(listingId,pricePerToken)=>{const listing=await this.validateListing(bignumber.gH.from(listingId)),normalizedPrice=await(0,normalizePriceValue_9851c0eb_browser_esm.n)(this.contractWrapper.getProvider(),pricePerToken,listing.currencyContractAddress);if(normalizedPrice.eq(bignumber.gH.from(0)))throw new Error("Cannot make a bid with 0 value");const bidBuffer=await this.contractWrapper.read("bidBufferBps",[]),winningBid=await this.getWinningBid(listingId);if(winningBid){const isWinner=(0,marketplace_e3129e2f_browser_esm.a)(winningBid.pricePerToken,normalizedPrice,bidBuffer);(0,tiny_invariant.A)(isWinner,"Bid price is too low based on the current winning bid and the bid buffer")}else{const tokenPrice=normalizedPrice,reservePrice=bignumber.gH.from(listing.reservePrice);(0,tiny_invariant.A)(tokenPrice.gte(reservePrice),"Bid price is too low based on reserve price")}const quantity=bignumber.gH.from(listing.quantity),value=normalizedPrice.mul(quantity),overrides=await this.contractWrapper.getCallOverrides()||{};await(0,setErc20Allowance_7f76f677_browser_esm.s)(this.contractWrapper,value,listing.currencyContractAddress,overrides);const tx=transactions_72f9603c_browser_esm.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"offer",args:[listingId,listing.quantity,listing.currencyContractAddress,normalizedPrice,bignumbers.Is],overrides});return tx.setGasLimitMultiple(1.2),tx}));cancelListing=(0,transactions_72f9603c_browser_esm.f)((async listingId=>{const listing=await this.validateListing(bignumber.gH.from(listingId)),now=bignumber.gH.from(Math.floor(Date.now()/1e3)),startTime=bignumber.gH.from(listing.startTimeInEpochSeconds),offers=await this.contractWrapper.read("winningBid",[listingId]);if(now.gt(startTime)&&offers.offeror!==addresses.L)throw new index_33cd3415_browser_esm.t(listingId.toString());const tx=transactions_72f9603c_browser_esm.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"closeAuction",args:[bignumber.gH.from(listingId),await this.contractWrapper.getSignerAddress()]});return tx.setGasLimitMultiple(1.2),tx}));closeListing=(0,transactions_72f9603c_browser_esm.f)((async(listingId,closeFor)=>{closeFor||(closeFor=await this.contractWrapper.getSignerAddress());const listing=await this.validateListing(bignumber.gH.from(listingId));try{const tx=transactions_72f9603c_browser_esm.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"closeAuction",args:[bignumber.gH.from(listingId),closeFor]});return tx.setGasLimitMultiple(1.2),tx}catch(err){throw err.message.includes("cannot close auction before it has ended")?new index_33cd3415_browser_esm.w(listingId.toString(),listing.endTimeInEpochSeconds.toString()):err}}));executeSale=(0,transactions_72f9603c_browser_esm.f)((async listingId=>{const listing=await this.validateListing(bignumber.gH.from(listingId));try{const winningBid=await this.getWinningBid(listingId);(0,tiny_invariant.A)(winningBid,"No winning bid found");const closeForSeller=this.encoder.encode("closeAuction",[listingId,listing.sellerAddress]),closeForBuyer=this.encoder.encode("closeAuction",[listingId,winningBid.buyerAddress]),tx=transactions_72f9603c_browser_esm.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"multicall",args:[closeForSeller,closeForBuyer]});return tx.setGasLimitMultiple(1.2),tx}catch(err){throw err.message.includes("cannot close auction before it has ended")?new index_33cd3415_browser_esm.w(listingId.toString(),listing.endTimeInEpochSeconds.toString()):err}}));updateListing=(0,transactions_72f9603c_browser_esm.f)((async listing=>{const tx=transactions_72f9603c_browser_esm.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"updateListing",args:[listing.id,listing.quantity,listing.reservePrice,listing.buyoutPrice,listing.currencyContractAddress,listing.startTimeInEpochSeconds,listing.endTimeInEpochSeconds]});return tx.setGasLimitMultiple(1.2),tx}));async getBidBufferBps(){return this.contractWrapper.read("bidBufferBps",[])}async getMinimumNextBid(listingId){const[currentBidBufferBps,winningBid,listing]=await Promise.all([this.getBidBufferBps(),this.getWinningBid(listingId),this.validateListing(bignumber.gH.from(listingId))]),currentBidOrReservePrice=winningBid?winningBid.currencyValue.value:listing.reservePrice,minimumNextBid=currentBidOrReservePrice.add(currentBidOrReservePrice.mul(currentBidBufferBps).div(1e4));return(0,fetchCurrencyValue_32d08b05_browser_esm.a)(this.contractWrapper.getProvider(),listing.currencyContractAddress,minimumNextBid)}async validateListing(listingId){try{return await this.getListing(listingId)}catch(err){throw console.error(`Error getting the listing with id ${listingId}`),err}}async mapListing(listing){return{assetContractAddress:listing.assetContract,buyoutPrice:bignumber.gH.from(listing.buyoutPricePerToken),currencyContractAddress:listing.currency,buyoutCurrencyValuePerToken:await(0,fetchCurrencyValue_32d08b05_browser_esm.a)(this.contractWrapper.getProvider(),listing.currency,listing.buyoutPricePerToken),id:listing.listingId.toString(),tokenId:listing.tokenId,quantity:listing.quantity,startTimeInEpochSeconds:listing.startTime,asset:await(0,QueryParams_32a56510_browser_esm.c)(listing.assetContract,this.contractWrapper.getProvider(),listing.tokenId,this.storage),reservePriceCurrencyValuePerToken:await(0,fetchCurrencyValue_32d08b05_browser_esm.a)(this.contractWrapper.getProvider(),listing.currency,listing.reservePricePerToken),reservePrice:bignumber.gH.from(listing.reservePricePerToken),endTimeInEpochSeconds:listing.endTime,sellerAddress:listing.tokenOwner,type:ListingType.Auction}}}class MarketplaceDirect{constructor(contractWrapper,storage){this.contractWrapper=contractWrapper,this.storage=storage}getAddress(){return this.contractWrapper.address}async getListing(listingId){const listing=await this.contractWrapper.read("listings",[listingId]);if(listing.assetContract===addresses.L)throw new index_33cd3415_browser_esm.L(this.getAddress(),listingId.toString());if(listing.listingType!==ListingType.Direct)throw new index_33cd3415_browser_esm.W(this.getAddress(),listingId.toString(),"Auction","Direct");return await this.mapListing(listing)}async getActiveOffer(listingId,address){await this.validateListing(bignumber.gH.from(listingId)),(0,tiny_invariant.A)(address_lib_esm.isAddress(address),"Address must be a valid address");const offers=await this.contractWrapper.read("offers",[listingId,await(0,index_33cd3415_browser_esm.aL)(address)]);if(offers.offeror!==addresses.L)return await(0,marketplace_e3129e2f_browser_esm.m)(this.contractWrapper.getProvider(),bignumber.gH.from(listingId),offers)}createListing=(0,transactions_72f9603c_browser_esm.f)((async listing=>{(0,marketplace_e3129e2f_browser_esm.v)(listing);const resolvedAssetAddress=await(0,index_33cd3415_browser_esm.aL)(listing.assetContractAddress),resolvedCurrencyAddress=await(0,index_33cd3415_browser_esm.aL)(listing.currencyContractAddress);await(0,marketplace_e3129e2f_browser_esm.h)(this.contractWrapper,this.getAddress(),resolvedAssetAddress,listing.tokenId,await this.contractWrapper.getSignerAddress());const normalizedPricePerToken=await(0,normalizePriceValue_9851c0eb_browser_esm.n)(this.contractWrapper.getProvider(),listing.buyoutPricePerToken,resolvedCurrencyAddress);let listingStartTime=Math.floor(listing.startTimestamp.getTime()/1e3);const blockTime=(await this.contractWrapper.getProvider().getBlock("latest")).timestamp;listingStartTime<blockTime&&(listingStartTime=blockTime);const tx=transactions_72f9603c_browser_esm.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"createListing",args:[{assetContract:resolvedAssetAddress,tokenId:listing.tokenId,buyoutPricePerToken:normalizedPricePerToken,currencyToAccept:(0,cleanCurrencyAddress_ded19cfe_browser_esm.c)(resolvedCurrencyAddress),listingType:ListingType.Direct,quantityToList:listing.quantity,reservePricePerToken:normalizedPricePerToken,secondsUntilEndTime:listing.listingDurationInSeconds,startTime:bignumber.gH.from(listingStartTime)}],parse:receipt=>({id:this.contractWrapper.parseLogs("ListingAdded",receipt?.logs)[0].args.listingId,receipt})});return tx.setGasLimitMultiple(1.2),tx}));createListingsBatch=(0,transactions_72f9603c_browser_esm.f)((async listings=>{const data=(await Promise.all(listings.map((listing=>this.createListing.prepare(listing))))).map((tx=>tx.encode())),tx=transactions_72f9603c_browser_esm.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"multicall",args:[data],parse:receipt=>this.contractWrapper.parseLogs("ListingAdded",receipt?.logs).map((event=>({id:event.args.listingId,receipt})))});return tx.setGasLimitMultiple(1.2),tx}));makeOffer=(0,transactions_72f9603c_browser_esm.f)((async(listingId,quantityDesired,currencyContractAddress,pricePerToken,expirationDate)=>{if((0,fetchCurrencyValue_32d08b05_browser_esm.i)(currencyContractAddress))throw new Error("You must use the wrapped native token address when making an offer with a native token");const normalizedPrice=await(0,normalizePriceValue_9851c0eb_browser_esm.n)(this.contractWrapper.getProvider(),pricePerToken,currencyContractAddress);try{await this.getListing(listingId)}catch(err){throw console.error("Failed to get listing, err =",err),new Error(`Error getting the listing with id ${listingId}`)}const quantity=bignumber.gH.from(quantityDesired),value=bignumber.gH.from(normalizedPrice).mul(quantity),overrides=await this.contractWrapper.getCallOverrides()||{};await(0,setErc20Allowance_7f76f677_browser_esm.s)(this.contractWrapper,value,currencyContractAddress,overrides);let expirationTimestamp=bignumbers.Is;expirationDate&&(expirationTimestamp=bignumber.gH.from(Math.floor(expirationDate.getTime()/1e3)));const tx=transactions_72f9603c_browser_esm.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"offer",args:[listingId,quantityDesired,currencyContractAddress,normalizedPrice,expirationTimestamp],overrides});return tx.setGasLimitMultiple(1.2),tx}));acceptOffer=(0,transactions_72f9603c_browser_esm.f)((async(listingId,addressOfOfferor)=>{await this.validateListing(bignumber.gH.from(listingId));const resolvedAddress=await(0,index_33cd3415_browser_esm.aL)(addressOfOfferor),offer=await this.contractWrapper.read("offers",[listingId,resolvedAddress]),tx=transactions_72f9603c_browser_esm.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"acceptOffer",args:[listingId,resolvedAddress,offer.currency,offer.pricePerToken]});return tx.setGasLimitMultiple(1.2),tx}));buyoutListing=(0,transactions_72f9603c_browser_esm.f)((async(listingId,quantityDesired,receiver)=>{const listing=await this.validateListing(bignumber.gH.from(listingId)),{valid,error}=await this.isStillValidListing(listing,quantityDesired);if(!valid)throw new Error(`Listing ${listingId} is no longer valid. ${error}`);const buyFor=receiver||await this.contractWrapper.getSignerAddress(),quantity=bignumber.gH.from(quantityDesired),value=bignumber.gH.from(listing.buyoutPrice).mul(quantity),overrides=await this.contractWrapper.getCallOverrides()||{};await(0,setErc20Allowance_7f76f677_browser_esm.s)(this.contractWrapper,value,listing.currencyContractAddress,overrides);const tx=transactions_72f9603c_browser_esm.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"buy",args:[listingId,buyFor,quantity,listing.currencyContractAddress,value],overrides});return tx.setGasLimitMultiple(1.2),tx}));updateListing=(0,transactions_72f9603c_browser_esm.f)((async listing=>{const tx=transactions_72f9603c_browser_esm.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"updateListing",args:[listing.id,listing.quantity,listing.buyoutPrice,listing.buyoutPrice,await(0,index_33cd3415_browser_esm.aL)(listing.currencyContractAddress),listing.startTimeInSeconds,listing.secondsUntilEnd]});return tx.setGasLimitMultiple(1.2),tx}));cancelListing=(0,transactions_72f9603c_browser_esm.f)((async listingId=>{const tx=transactions_72f9603c_browser_esm.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"cancelDirectListing",args:[listingId]});return tx.setGasLimitMultiple(1.2),tx}));async validateListing(listingId){try{return await this.getListing(listingId)}catch(err){throw console.error(`Error getting the listing with id ${listingId}`),err}}async mapListing(listing){return{assetContractAddress:listing.assetContract,buyoutPrice:bignumber.gH.from(listing.buyoutPricePerToken),currencyContractAddress:listing.currency,buyoutCurrencyValuePerToken:await(0,fetchCurrencyValue_32d08b05_browser_esm.a)(this.contractWrapper.getProvider(),listing.currency,listing.buyoutPricePerToken),id:listing.listingId.toString(),tokenId:listing.tokenId,quantity:listing.quantity,startTimeInSeconds:listing.startTime,asset:await(0,QueryParams_32a56510_browser_esm.c)(listing.assetContract,this.contractWrapper.getProvider(),listing.tokenId,this.storage),secondsUntilEnd:listing.endTime,sellerAddress:listing.tokenOwner,type:ListingType.Direct}}async isStillValidListing(listing,quantity){if(!await(0,marketplace_e3129e2f_browser_esm.i)(this.contractWrapper.getProvider(),this.getAddress(),listing.assetContractAddress,listing.tokenId,listing.sellerAddress))return{valid:!1,error:`Token '${listing.tokenId}' from contract '${listing.assetContractAddress}' is not approved for transfer`};const provider=this.contractWrapper.getProvider(),ERC165Abi=(await __webpack_require__.e(4811).then(__webpack_require__.t.bind(__webpack_require__,"./node_modules/@thirdweb-dev/contracts-js/dist/abis/IERC165.json",19))).default,erc165=new contracts_lib_esm.NZ(listing.assetContractAddress,ERC165Abi,provider),isERC721=await erc165.supportsInterface(QueryParams_32a56510_browser_esm.I),isERC1155=await erc165.supportsInterface(QueryParams_32a56510_browser_esm.a);if(isERC721){const ERC721Abi=(await Promise.resolve().then(__webpack_require__.t.bind(__webpack_require__,"./node_modules/@thirdweb-dev/contracts-js/dist/abis/IERC721.json",19))).default,asset=new contracts_lib_esm.NZ(listing.assetContractAddress,ERC721Abi,provider);let owner;try{owner=await asset.ownerOf(listing.tokenId)}catch(e){}const valid=owner?.toLowerCase()===listing.sellerAddress.toLowerCase();return{valid,error:valid?void 0:`Seller is not the owner of Token '${listing.tokenId}' from contract '${listing.assetContractAddress} anymore'`}}if(isERC1155){const ERC1155Abi=(await Promise.resolve().then(__webpack_require__.t.bind(__webpack_require__,"./node_modules/@thirdweb-dev/contracts-js/dist/abis/IERC1155.json",19))).default,asset=new contracts_lib_esm.NZ(listing.assetContractAddress,ERC1155Abi,provider),valid=(await asset.balanceOf(listing.sellerAddress,listing.tokenId)).gte(quantity||listing.quantity);return{valid,error:valid?void 0:`Seller does not have enough balance of Token '${listing.tokenId}' from contract '${listing.assetContractAddress} to fulfill the listing`}}return{valid:!1,error:"Contract does not implement ERC 1155 or ERC 721."}}}class Marketplace{static contractRoles=index_33cd3415_browser_esm.dH;get chainId(){return this._chainId}constructor(network,address,storage){let options=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},abi=arguments.length>4?arguments[4]:void 0,chainId=arguments.length>5?arguments[5]:void 0,contractWrapper=arguments.length>6&&void 0!==arguments[6]?arguments[6]:new index_33cd3415_browser_esm.cs(network,address,abi,options,storage);this._chainId=chainId,this.abi=index_33cd3415_browser_esm.bj.parse(abi||[]),this.contractWrapper=contractWrapper,this.storage=storage,this.metadata=new contract_appuri_5c40af52_browser_esm.C(this.contractWrapper,index_33cd3415_browser_esm.b$,this.storage),this.app=new contract_appuri_5c40af52_browser_esm.b(this.contractWrapper,this.metadata,this.storage),this.roles=new contract_roles_71988d2e_browser_esm.C(this.contractWrapper,Marketplace.contractRoles),this.encoder=new fetchCurrencyValue_32d08b05_browser_esm.C(this.contractWrapper),this.estimator=new contract_appuri_5c40af52_browser_esm.G(this.contractWrapper),this.direct=new MarketplaceDirect(this.contractWrapper,this.storage),this.auction=new MarketplaceAuction(this.contractWrapper,this.storage),this.events=new contract_appuri_5c40af52_browser_esm.a(this.contractWrapper),this.platformFees=new contract_platform_fee_e756e68f_browser_esm.C(this.contractWrapper),this.interceptor=new contract_interceptor_d7b164a7_browser_esm.C(this.contractWrapper)}onNetworkUpdated(network){this.contractWrapper.updateSignerOrProvider(network)}getAddress(){return this.contractWrapper.address}async getListing(listingId){const listing=await this.contractWrapper.read("listings",[listingId]);if(listing.assetContract===addresses.L)throw new index_33cd3415_browser_esm.L(this.getAddress(),listingId.toString());switch(listing.listingType){case ListingType.Auction:return await this.auction.mapListing(listing);case ListingType.Direct:return await this.direct.mapListing(listing);default:throw new Error(`Unknown listing type: ${listing.listingType}`)}}async getActiveListings(filter){const rawListings=await this.getAllListingsNoFilter(!0),filtered=this.applyFilter(rawListings,filter),now=bignumber.gH.from(Math.floor(Date.now()/1e3));return filtered.filter((l=>l.type===ListingType.Auction&&bignumber.gH.from(l.endTimeInEpochSeconds).gt(now)&&bignumber.gH.from(l.startTimeInEpochSeconds).lte(now)||l.type===ListingType.Direct&&bignumber.gH.from(l.quantity).gt(0)))}async getAllListings(filter){const rawListings=await this.getAllListingsNoFilter(!1);return this.applyFilter(rawListings,filter)}getAll=this.getAllListings;async getTotalCount(){return await this.contractWrapper.read("totalListings",[])}async isRestrictedToListerRoleOnly(){return!await this.contractWrapper.read("hasRole",[(0,index_33cd3415_browser_esm.H)("lister"),addresses.L])}async getBidBufferBps(){return this.contractWrapper.read("bidBufferBps",[])}async getTimeBufferInSeconds(){return this.contractWrapper.read("timeBuffer",[])}async getOffers(listingId){const listingEvents=await this.events.getEvents("NewOffer",{order:"desc",filters:{listingId}});return await Promise.all(listingEvents.map((e=>(0,marketplace_e3129e2f_browser_esm.m)(this.contractWrapper.getProvider(),bignumber.gH.from(listingId),{quantityWanted:e.data.quantityWanted,pricePerToken:e.data.quantityWanted.gt(0)?e.data.totalOfferAmount.div(e.data.quantityWanted):e.data.totalOfferAmount,currency:e.data.currency,offeror:e.data.offeror}))))}buyoutListing=(0,transactions_72f9603c_browser_esm.f)((async(listingId,quantityDesired,receiver)=>{const listing=await this.contractWrapper.read("listings",[listingId]);if(listing.listingId.toString()!==listingId.toString())throw new index_33cd3415_browser_esm.L(this.getAddress(),listingId.toString());switch(listing.listingType){case ListingType.Direct:return(0,tiny_invariant.A)(void 0!==quantityDesired,"quantityDesired is required when buying out a direct listing"),await this.direct.buyoutListing.prepare(listingId,quantityDesired,receiver);case ListingType.Auction:return await this.auction.buyoutListing.prepare(listingId);default:throw Error(`Unknown listing type: ${listing.listingType}`)}}));makeOffer=(0,transactions_72f9603c_browser_esm.f)((async(listingId,pricePerToken,quantity)=>{const listing=await this.contractWrapper.read("listings",[listingId]);if(listing.listingId.toString()!==listingId.toString())throw new index_33cd3415_browser_esm.L(this.getAddress(),listingId.toString());const chainId=await this.contractWrapper.getChainID();switch(listing.listingType){case ListingType.Direct:return(0,tiny_invariant.A)(quantity,"quantity is required when making an offer on a direct listing"),await this.direct.makeOffer.prepare(listingId,quantity,(0,fetchCurrencyValue_32d08b05_browser_esm.i)(listing.currency)?index_33cd3415_browser_esm.aW[chainId].wrapped.address:listing.currency,pricePerToken);case ListingType.Auction:return await this.auction.makeBid.prepare(listingId,pricePerToken);default:throw Error(`Unknown listing type: ${listing.listingType}`)}}));setBidBufferBps=(0,transactions_72f9603c_browser_esm.f)((async bufferBps=>{await this.roles.verify(["admin"],await this.contractWrapper.getSignerAddress());const timeBuffer=await this.getTimeBufferInSeconds();return transactions_72f9603c_browser_esm.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"setAuctionBuffers",args:[timeBuffer,bignumber.gH.from(bufferBps)]})}));setTimeBufferInSeconds=(0,transactions_72f9603c_browser_esm.f)((async bufferInSeconds=>{await this.roles.verify(["admin"],await this.contractWrapper.getSignerAddress());const bidBuffer=await this.getBidBufferBps();return transactions_72f9603c_browser_esm.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"setAuctionBuffers",args:[bignumber.gH.from(bufferInSeconds),bidBuffer]})}));allowListingFromSpecificAssetOnly=(0,transactions_72f9603c_browser_esm.f)((async contractAddress=>{const encoded=[];return(await this.roles.get("asset")).includes(addresses.L)&&encoded.push(this.encoder.encode("revokeRole",[(0,index_33cd3415_browser_esm.H)("asset"),addresses.L])),encoded.push(this.encoder.encode("grantRole",[(0,index_33cd3415_browser_esm.H)("asset"),contractAddress])),transactions_72f9603c_browser_esm.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"multicall",args:[encoded]})}));allowListingFromAnyAsset=(0,transactions_72f9603c_browser_esm.f)((async()=>{const encoded=[],members=await this.roles.get("asset");for(const addr in members)encoded.push(this.encoder.encode("revokeRole",[(0,index_33cd3415_browser_esm.H)("asset"),addr]));return encoded.push(this.encoder.encode("grantRole",[(0,index_33cd3415_browser_esm.H)("asset"),addresses.L])),transactions_72f9603c_browser_esm.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"multicall",args:[encoded]})}));async getAllListingsNoFilter(filterInvalidListings){return(await Promise.all(Array.from(Array((await this.contractWrapper.read("totalListings",[])).toNumber()).keys()).map((async i=>{let listing;try{listing=await this.getListing(i)}catch(err){return err instanceof index_33cd3415_browser_esm.L?void 0:void console.warn(`Failed to get listing ${i}' - skipping. Try 'marketplace.getListing(${i})' to get the underlying error.`)}if(listing.type===ListingType.Auction)return listing;if(filterInvalidListings){const{valid}=await this.direct.isStillValidListing(listing);if(!valid)return}return listing})))).filter((l=>void 0!==l))}applyFilter(listings,filter){let rawListings=[...listings];const start=bignumber.gH.from(filter?.start||0).toNumber(),count=bignumber.gH.from(filter?.count||QueryParams_32a56510_browser_esm.D).toNumber();return filter&&(filter.seller&&(rawListings=rawListings.filter((seller=>seller.sellerAddress.toString().toLowerCase()===filter?.seller?.toString().toLowerCase()))),filter.tokenContract&&(rawListings=rawListings.filter((tokenContract=>tokenContract.assetContractAddress.toString().toLowerCase()===filter?.tokenContract?.toString().toLowerCase()))),void 0!==filter.tokenId&&(rawListings=rawListings.filter((tokenContract=>tokenContract.tokenId.toString()===filter?.tokenId?.toString()))),rawListings=rawListings.filter(((_,index)=>index>=start)),rawListings=rawListings.slice(0,count)),rawListings}async prepare(method,args,overrides){return transactions_72f9603c_browser_esm.T.fromContractWrapper({contractWrapper:this.contractWrapper,method,args,overrides})}async call(functionName,args,overrides){return this.contractWrapper.call(functionName,args,overrides)}}},"./node_modules/@thirdweb-dev/sdk/dist/marketplace-e3129e2f.browser.esm.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{a:()=>isWinningBid,g:()=>getAllInBatches,h:()=>handleTokenApproval,i:()=>isTokenApprovedForTransfer,m:()=>mapOffer,v:()=>validateNewListingParam});var ethers__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@ethersproject/contracts/lib.esm/index.js"),ethers__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@ethersproject/bignumber/lib.esm/bignumber.js"),tiny_invariant__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/tiny-invariant/dist/esm/tiny-invariant.js"),_QueryParams_32a56510_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@thirdweb-dev/sdk/dist/QueryParams-32a56510.browser.esm.js"),_index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@thirdweb-dev/sdk/dist/index-33cd3415.browser.esm.js"),_fetchCurrencyValue_32d08b05_browser_esm_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@thirdweb-dev/sdk/dist/fetchCurrencyValue-32d08b05.browser.esm.js"),console=__webpack_require__("./node_modules/console-browserify/index.js");async function isTokenApprovedForTransfer(provider,transferrerContractAddress,assetContract,tokenId,owner){try{const ERC165Abi=(await __webpack_require__.e(4811).then(__webpack_require__.t.bind(__webpack_require__,"./node_modules/@thirdweb-dev/contracts-js/dist/abis/IERC165.json",19))).default,erc165=new ethers__WEBPACK_IMPORTED_MODULE_0__.NZ(assetContract,ERC165Abi,provider),[isERC721,isERC1155]=await Promise.all([erc165.supportsInterface(_QueryParams_32a56510_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.I),erc165.supportsInterface(_QueryParams_32a56510_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.a)]);if(isERC721){const ERC721Abi=(await Promise.resolve().then(__webpack_require__.t.bind(__webpack_require__,"./node_modules/@thirdweb-dev/contracts-js/dist/abis/IERC721.json",19))).default,asset=new ethers__WEBPACK_IMPORTED_MODULE_0__.NZ(assetContract,ERC721Abi,provider);if(await asset.isApprovedForAll(owner,transferrerContractAddress))return!0;let approvedAddress;try{approvedAddress=await asset.getApproved(tokenId)}catch(e){}return approvedAddress?.toLowerCase()===transferrerContractAddress.toLowerCase()}if(isERC1155){const ERC1155Abi=(await Promise.resolve().then(__webpack_require__.t.bind(__webpack_require__,"./node_modules/@thirdweb-dev/contracts-js/dist/abis/IERC1155.json",19))).default,asset=new ethers__WEBPACK_IMPORTED_MODULE_0__.NZ(assetContract,ERC1155Abi,provider);return await asset.isApprovedForAll(owner,transferrerContractAddress)}return console.error("Contract does not implement ERC 1155 or ERC 721."),!1}catch(err){return console.error("Failed to check if token is approved",err),!1}}async function handleTokenApproval(contractWrapper,marketplaceAddress,assetContract,tokenId,from){const ERC165Abi=(await __webpack_require__.e(4811).then(__webpack_require__.t.bind(__webpack_require__,"./node_modules/@thirdweb-dev/contracts-js/dist/abis/IERC165.json",19))).default,erc165=new _index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_2__.cs(contractWrapper.getSignerOrProvider(),assetContract,ERC165Abi,contractWrapper.options,contractWrapper.storage),[isERC721,isERC1155]=await Promise.all([erc165.read("supportsInterface",[_QueryParams_32a56510_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.I]),erc165.read("supportsInterface",[_QueryParams_32a56510_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.a])]);if(isERC721){const ERC721Abi=(await Promise.resolve().then(__webpack_require__.t.bind(__webpack_require__,"./node_modules/@thirdweb-dev/contracts-js/dist/abis/IERC721.json",19))).default,asset=new _index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_2__.cs(contractWrapper.getSignerOrProvider(),assetContract,ERC721Abi,contractWrapper.options,contractWrapper.storage);if(!await asset.read("isApprovedForAll",[from,marketplaceAddress])){(await asset.read("getApproved",[tokenId])).toLowerCase()===marketplaceAddress.toLowerCase()||await asset.sendTransaction("setApprovalForAll",[marketplaceAddress,!0])}}else{if(!isERC1155)throw Error("Contract must implement ERC 1155 or ERC 721.");{const ERC1155Abi=(await Promise.resolve().then(__webpack_require__.t.bind(__webpack_require__,"./node_modules/@thirdweb-dev/contracts-js/dist/abis/IERC1155.json",19))).default,asset=new _index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_2__.cs(contractWrapper.getSignerOrProvider(),assetContract,ERC1155Abi,contractWrapper.options,contractWrapper.storage);await asset.read("isApprovedForAll",[from,marketplaceAddress])||await asset.sendTransaction("setApprovalForAll",[marketplaceAddress,!0])}}}function validateNewListingParam(param){if((0,tiny_invariant__WEBPACK_IMPORTED_MODULE_3__.A)(void 0!==param.assetContractAddress&&null!==param.assetContractAddress,"Asset contract address is required"),(0,tiny_invariant__WEBPACK_IMPORTED_MODULE_3__.A)(void 0!==param.buyoutPricePerToken&&null!==param.buyoutPricePerToken,"Buyout price is required"),(0,tiny_invariant__WEBPACK_IMPORTED_MODULE_3__.A)(void 0!==param.listingDurationInSeconds&&null!==param.listingDurationInSeconds,"Listing duration is required"),(0,tiny_invariant__WEBPACK_IMPORTED_MODULE_3__.A)(void 0!==param.startTimestamp&&null!==param.startTimestamp,"Start time is required"),(0,tiny_invariant__WEBPACK_IMPORTED_MODULE_3__.A)(void 0!==param.tokenId&&null!==param.tokenId,"Token ID is required"),(0,tiny_invariant__WEBPACK_IMPORTED_MODULE_3__.A)(void 0!==param.quantity&&null!==param.quantity,"Quantity is required"),"NewAuctionListing"===param.type)(0,tiny_invariant__WEBPACK_IMPORTED_MODULE_3__.A)(void 0!==param.reservePricePerToken&&null!==param.reservePricePerToken,"Reserve price is required")}async function mapOffer(provider,listingId,offer){return{quantity:offer.quantityDesired,pricePerToken:offer.pricePerToken,currencyContractAddress:offer.currency,buyerAddress:offer.offeror,quantityDesired:offer.quantityWanted,currencyValue:await(0,_fetchCurrencyValue_32d08b05_browser_esm_js__WEBPACK_IMPORTED_MODULE_4__.a)(provider,offer.currency,offer.quantityWanted.mul(offer.pricePerToken)),listingId}}function isWinningBid(winningPrice,newBidPrice,bidBuffer){if(bidBuffer=ethers__WEBPACK_IMPORTED_MODULE_5__.gH.from(bidBuffer),winningPrice=ethers__WEBPACK_IMPORTED_MODULE_5__.gH.from(winningPrice),newBidPrice=ethers__WEBPACK_IMPORTED_MODULE_5__.gH.from(newBidPrice),winningPrice.eq(ethers__WEBPACK_IMPORTED_MODULE_5__.gH.from(0)))return!1;return newBidPrice.sub(winningPrice).mul(_index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_2__.dE).div(winningPrice).gte(bidBuffer)}async function getAllInBatches(start,end,fn){const batches=[];for(;end-start>_QueryParams_32a56510_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.D;)batches.push(fn(start,start+_QueryParams_32a56510_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.D-1)),start+=_QueryParams_32a56510_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.D;return batches.push(fn(start,end-1)),await Promise.all(batches)}},"./node_modules/@thirdweb-dev/sdk/dist/setErc20Allowance-7f76f677.browser.esm.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{B:()=>BasicNFTInput,C:()=>CommonNFTInput,N:()=>NFTInputOrUriSchema,a:()=>CommonNFTOutput,s:()=>setErc20Allowance});var _index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@thirdweb-dev/sdk/dist/index-33cd3415.browser.esm.js"),zod__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/zod/lib/index.mjs"),_fetchCurrencyValue_32d08b05_browser_esm_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@thirdweb-dev/sdk/dist/fetchCurrencyValue-32d08b05.browser.esm.js");const PropertiesInput=(()=>zod__WEBPACK_IMPORTED_MODULE_0__.z.object({}).catchall(zod__WEBPACK_IMPORTED_MODULE_0__.z.union([_index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.cx,zod__WEBPACK_IMPORTED_MODULE_0__.z.unknown()])))(),OptionalPropertiesInput=(()=>zod__WEBPACK_IMPORTED_MODULE_0__.z.union([zod__WEBPACK_IMPORTED_MODULE_0__.z.array(zod__WEBPACK_IMPORTED_MODULE_0__.z.array(PropertiesInput)).transform((i=>i.flat())),zod__WEBPACK_IMPORTED_MODULE_0__.z.array(PropertiesInput),PropertiesInput]).optional().nullable())(),BasicNFTInput=(()=>zod__WEBPACK_IMPORTED_MODULE_0__.z.object({name:zod__WEBPACK_IMPORTED_MODULE_0__.z.union([zod__WEBPACK_IMPORTED_MODULE_0__.z.string(),zod__WEBPACK_IMPORTED_MODULE_0__.z.number()]).optional().nullable(),description:zod__WEBPACK_IMPORTED_MODULE_0__.z.string().nullable().optional().nullable(),image:_index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.cy.nullable().optional(),animation_url:_index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.cy.optional().nullable()}))(),CommonNFTInput=(()=>BasicNFTInput.extend({external_url:_index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.cy.nullable().optional(),background_color:_index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.cz.optional().nullable(),properties:OptionalPropertiesInput,attributes:OptionalPropertiesInput}).catchall(zod__WEBPACK_IMPORTED_MODULE_0__.z.union([_index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.cx,zod__WEBPACK_IMPORTED_MODULE_0__.z.unknown()])))(),NFTInputOrUriSchema=(()=>zod__WEBPACK_IMPORTED_MODULE_0__.z.union([CommonNFTInput,zod__WEBPACK_IMPORTED_MODULE_0__.z.string()]))(),CommonNFTOutput=(()=>CommonNFTInput.extend({id:zod__WEBPACK_IMPORTED_MODULE_0__.z.string(),uri:zod__WEBPACK_IMPORTED_MODULE_0__.z.string(),image:zod__WEBPACK_IMPORTED_MODULE_0__.z.string().nullable().optional(),external_url:zod__WEBPACK_IMPORTED_MODULE_0__.z.string().nullable().optional(),animation_url:zod__WEBPACK_IMPORTED_MODULE_0__.z.string().nullable().optional()}))();async function setErc20Allowance(contractToApprove,value,currencyAddress,overrides){if(!(0,_fetchCurrencyValue_32d08b05_browser_esm_js__WEBPACK_IMPORTED_MODULE_2__.i)(currencyAddress)){const ERC20Abi=(await Promise.resolve().then(__webpack_require__.t.bind(__webpack_require__,"./node_modules/@thirdweb-dev/contracts-js/dist/abis/IERC20.json",19))).default,signer=contractToApprove.getSigner(),provider=contractToApprove.getProvider(),erc20=new _index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.cs(signer||provider,currencyAddress,ERC20Abi,contractToApprove.options,contractToApprove.storage),owner=await contractToApprove.getSignerAddress(),spender=contractToApprove.address;return(await erc20.read("allowance",[owner,spender])).lt(value)&&await erc20.sendTransaction("approve",[spender,value]),overrides}overrides.value=value}}}]);