"use strict";(self.webpackChunkan_onchain_app_in_100_components=self.webpackChunkan_onchain_app_in_100_components||[]).push([[3682],{"./node_modules/@thirdweb-dev/wallets/dist/http-rpc-client-0a079e80.browser.esm.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{D:()=>DEBUG,H:()=>HttpRpcClient,g:()=>getUserOpHashV06,h:()=>hexlifyUserOp,r:()=>randomNonce});var ethers__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@ethersproject/properties/lib.esm/index.js"),ethers__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@ethersproject/bytes/lib.esm/index.js"),ethers__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@ethersproject/keccak256/lib.esm/index.js"),ethers__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@ethersproject/abi/lib.esm/abi-coder.js"),ethers__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@ethersproject/bignumber/lib.esm/bignumber.js"),ethers__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@ethersproject/providers/lib.esm/url-json-rpc-provider.js"),_url_a45219bd_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@thirdweb-dev/wallets/dist/url-a45219bd.browser.esm.js"),_headers_733a8199_browser_esm_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@thirdweb-dev/wallets/dist/headers-733a8199.browser.esm.js"),_utils_f58e7acc_browser_esm_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@thirdweb-dev/wallets/dist/utils-f58e7acc.browser.esm.js");async function hexlifyUserOp(op){const userOp=await ethers__WEBPACK_IMPORTED_MODULE_0__.resolveProperties(op);return Object.keys(userOp).map((key=>{let val=userOp[key];return"string"==typeof val&&val.startsWith("0x")||(val=ethers__WEBPACK_IMPORTED_MODULE_1__.hexValue(val)),[key,val]})).reduce(((set,_ref)=>{let[k,v]=_ref;return{...set,[k]:v}}),{})}async function getUserOpHashV06(userOp,entryPoint,chainId){const op=await ethers__WEBPACK_IMPORTED_MODULE_0__.resolveProperties(userOp),hashedUserOp={sender:op.sender,nonce:op.nonce,initCodeHash:ethers__WEBPACK_IMPORTED_MODULE_2__.keccak256(op.initCode),callDataHash:ethers__WEBPACK_IMPORTED_MODULE_2__.keccak256(op.callData),callGasLimit:op.callGasLimit,verificationGasLimit:op.verificationGasLimit,preVerificationGas:op.preVerificationGas,maxFeePerGas:op.maxFeePerGas,maxPriorityFeePerGas:op.maxPriorityFeePerGas,paymasterAndDataHash:ethers__WEBPACK_IMPORTED_MODULE_2__.keccak256(op.paymasterAndData)},encoded=ethers__WEBPACK_IMPORTED_MODULE_3__.D.encode([{components:[{type:"address",name:"sender"},{type:"uint256",name:"nonce"},{type:"bytes32",name:"initCodeHash"},{type:"bytes32",name:"callDataHash"},{type:"uint256",name:"callGasLimit"},{type:"uint256",name:"verificationGasLimit"},{type:"uint256",name:"preVerificationGas"},{type:"uint256",name:"maxFeePerGas"},{type:"uint256",name:"maxPriorityFeePerGas"},{type:"bytes32",name:"paymasterAndDataHash"}],name:"hashedUserOp",type:"tuple"}],[{...hashedUserOp}]),userOpHash=ethers__WEBPACK_IMPORTED_MODULE_2__.keccak256(encoded),enc=ethers__WEBPACK_IMPORTED_MODULE_3__.D.encode(["bytes32","address","uint256"],[userOpHash,entryPoint,chainId]);return ethers__WEBPACK_IMPORTED_MODULE_2__.keccak256(enc)}const randomNonce=()=>{let hexString=(()=>{const rand1=BigInt(Math.floor(4294967296*Math.random())),rand2=BigInt(Math.floor(4294967296*Math.random())),rand3=BigInt(Math.floor(4294967296*Math.random())),rand4=BigInt(Math.floor(4294967296*Math.random())),rand5=BigInt(Math.floor(4294967296*Math.random())),rand6=BigInt(Math.floor(4294967296*Math.random()));return rand1<<BigInt(160)|rand2<<BigInt(128)|rand3<<BigInt(96)|rand4<<BigInt(64)|rand5<<BigInt(32)|rand6})().toString(16);return hexString.length%2!=0&&(hexString="0"+hexString),hexString="0x"+hexString,ethers__WEBPACK_IMPORTED_MODULE_4__.gH.from(ethers__WEBPACK_IMPORTED_MODULE_1__.concat([hexString,"0x0000000000000000"]))},DEBUG=!1;class HttpRpcClient{constructor(bundlerUrl,entryPointAddress,chainId,clientId,secretKey){this.bundlerUrl=bundlerUrl,this.entryPointAddress=entryPointAddress,this.chainId=chainId;const headers={};if((0,_url_a45219bd_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.i)(this.bundlerUrl)){const bundleId="undefined"!=typeof globalThis&&"APP_BUNDLE_ID"in globalThis?globalThis.APP_BUNDLE_ID:void 0;secretKey?headers["x-secret-key"]=secretKey:clientId&&(headers["x-client-id"]=clientId,bundleId&&(headers["x-bundle-id"]=bundleId)),"undefined"!=typeof globalThis&&"TW_AUTH_TOKEN"in globalThis&&"string"==typeof globalThis.TW_AUTH_TOKEN&&(headers.authorization=`Bearer ${globalThis.TW_AUTH_TOKEN}`),"undefined"!=typeof globalThis&&"TW_CLI_AUTH_TOKEN"in globalThis&&"string"==typeof globalThis.TW_CLI_AUTH_TOKEN&&(headers.authorization=`Bearer ${globalThis.TW_CLI_AUTH_TOKEN}`,headers["x-authorize-wallet"]="true"),(0,_headers_733a8199_browser_esm_js__WEBPACK_IMPORTED_MODULE_6__.s)(headers)}this.userOpJsonRpcProvider=new ethers__WEBPACK_IMPORTED_MODULE_7__.B({url:this.bundlerUrl,headers},{name:"Connected bundler network",chainId}),this.initializing=this.validateChainId()}async validateChainId(){if(await(0,_utils_f58e7acc_browser_esm_js__WEBPACK_IMPORTED_MODULE_8__.e)(this.chainId))return;const chain=await this.userOpJsonRpcProvider.send("eth_chainId",[]),bundlerChain=parseInt(chain);if(bundlerChain!==this.chainId)throw new Error(`bundler ${this.bundlerUrl} is on chainId ${bundlerChain}, but provider is on chainId ${this.chainId}`)}async sendUserOpToBundler(userOp1){await this.initializing;const hexifiedUserOp=await hexlifyUserOp(userOp1),jsonRequestData=[hexifiedUserOp,this.entryPointAddress];return await this.printUserOperation("eth_sendUserOperation",jsonRequestData),await this.userOpJsonRpcProvider.send("eth_sendUserOperation",[hexifiedUserOp,this.entryPointAddress])}async estimateUserOpGas(userOp){await this.initializing;const hexifiedUserOp=await hexlifyUserOp(userOp),jsonRequestData=[hexifiedUserOp,this.entryPointAddress];await this.printUserOperation("eth_estimateUserOperationGas",jsonRequestData);const data=await this.userOpJsonRpcProvider.send("eth_estimateUserOperationGas",[hexifiedUserOp,this.entryPointAddress]);return{preVerificationGas:ethers__WEBPACK_IMPORTED_MODULE_4__.gH.from(data.preVerificationGas),verificationGas:ethers__WEBPACK_IMPORTED_MODULE_4__.gH.from(data.verificationGas),verificationGasLimit:ethers__WEBPACK_IMPORTED_MODULE_4__.gH.from(data.verificationGasLimit),callGasLimit:ethers__WEBPACK_IMPORTED_MODULE_4__.gH.from(data.callGasLimit).add(_utils_f58e7acc_browser_esm_js__WEBPACK_IMPORTED_MODULE_8__.M)}}async getUserOperationGasPrice(){return await this.initializing,await this.userOpJsonRpcProvider.send("thirdweb_getUserOperationGasPrice",[])}async getUserOperationReceipt(userOpHash){return await this.initializing,await this.userOpJsonRpcProvider.send("eth_getUserOperationReceipt",[userOpHash])}async zkPaymasterData(transactionInput){return await this.initializing,await this.userOpJsonRpcProvider.send("zk_paymasterData",[await hexlifyUserOp({...transactionInput,gas:transactionInput.gasLimit})])}async zkBroadcastTransaction(transactionInput){return await this.initializing,await this.userOpJsonRpcProvider.send("zk_broadcastTransaction",[transactionInput])}async printUserOperation(method,_ref){}}},"./node_modules/@thirdweb-dev/wallets/dist/zk-connector-fada2157.browser.esm.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{ZkSyncConnector:()=>ZkSyncConnector});var _defineProperty_350fc508_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./node_modules/@thirdweb-dev/wallets/dist/defineProperty-350fc508.browser.esm.js"),_connector_05689d68_browser_esm_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/@thirdweb-dev/wallets/dist/connector-05689d68.browser.esm.js"),_http_rpc_client_0a079e80_browser_esm_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./node_modules/@thirdweb-dev/wallets/dist/http-rpc-client-0a079e80.browser.esm.js"),_utils_f58e7acc_browser_esm_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./node_modules/@thirdweb-dev/wallets/dist/utils-f58e7acc.browser.esm.js"),ethers__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@ethersproject/abstract-signer/lib.esm/index.js"),ethers__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@ethersproject/bignumber/lib.esm/bignumber.js"),ethers__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@ethersproject/bytes/lib.esm/index.js"),ethers__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@ethersproject/transactions/lib.esm/index.js"),ethers__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@ethersproject/address/lib.esm/index.js"),ethers__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@ethersproject/rlp/lib.esm/index.js"),ethers_lib_utils__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/ethers/lib/utils.js");__webpack_require__("./node_modules/eventemitter3/index.mjs"),__webpack_require__("./node_modules/@thirdweb-dev/wallets/evm/wallets/abstract/dist/thirdweb-dev-wallets-evm-wallets-abstract.browser.esm.js"),__webpack_require__("./node_modules/@account-abstraction/contracts/dist/index.js");const EIP712_TYPES={Transaction:[{name:"txType",type:"uint256"},{name:"from",type:"uint256"},{name:"to",type:"uint256"},{name:"gasLimit",type:"uint256"},{name:"gasPerPubdataByteLimit",type:"uint256"},{name:"maxFeePerGas",type:"uint256"},{name:"maxPriorityFeePerGas",type:"uint256"},{name:"paymaster",type:"uint256"},{name:"nonce",type:"uint256"},{name:"value",type:"uint256"},{name:"data",type:"bytes"},{name:"factoryDeps",type:"bytes32[]"},{name:"paymasterInput",type:"bytes"}]};class ZkWrappedSigner extends ethers__WEBPACK_IMPORTED_MODULE_3__.Signer{constructor(signer,httpRpcClient){super(),this.signer=signer,(0,ethers_lib_utils__WEBPACK_IMPORTED_MODULE_4__.defineReadOnly)(this,"provider",signer.provider),this.httpRpcClient=httpRpcClient}async getAddress(){return await this.signer.getAddress()}async signMessage(message){return await this.signer.signMessage(message)}async signTransaction(transaction){return await this.signer.signTransaction(transaction)}connect(provider){return new ZkWrappedSigner(this.signer.connect(provider),this.httpRpcClient)}_signTypedData(domain,types,value){return this.signer._signTypedData(domain,types,value)}async sendTransaction(transaction){return await this.sendZkSyncTransaction(transaction)}async sendZkSyncTransaction(_transaction){let transaction=await this.populateTransaction(_transaction);if(!transaction.chainId)throw new Error("ChainId is required to send a ZkSync transaction");if(!this.provider)throw new Error("Provider is required to send a ZkSync transaction");const address=await this.getAddress(),gasLimit=ethers__WEBPACK_IMPORTED_MODULE_5__.gH.from(transaction.gasLimit||await this.provider.estimateGas(transaction)).mul(3),gasPrice=ethers__WEBPACK_IMPORTED_MODULE_5__.gH.from(transaction.gasPrice||await this.provider.getGasPrice()).mul(2);transaction.maxFeePerGas?transaction.maxFeePerGas=transaction.maxFeePerGas.mul(2):transaction.maxFeePerGas=gasPrice,transaction.maxPriorityFeePerGas?transaction.maxPriorityFeePerGas=transaction.maxPriorityFeePerGas.mul(2):transaction.maxPriorityFeePerGas=gasPrice,transaction={...transaction,from:address,gasLimit,gasPrice,chainId:(await this.provider.getNetwork()).chainId,nonce:await this.provider.getTransactionCount(address),type:113,value:BigInt(0)};const pmDataResult=await(this.httpRpcClient?.zkPaymasterData(transaction));transaction.customData={gasPerPubdata:5e4,factoryDeps:[],paymasterParams:{paymaster:pmDataResult.paymaster,paymasterInput:pmDataResult.paymasterInput}};const eip712tx={txType:113,from:BigInt(transaction.from||await this.getAddress()).toString(),to:BigInt(transaction.to||"0x0").toString(),gasLimit:transaction.gasLimit?Number(transaction.gasLimit):0,gasPerPubdataByteLimit:5e4,maxFeePerGas:ethers__WEBPACK_IMPORTED_MODULE_5__.gH.from(transaction.maxFeePerGas).toNumber(),maxPriorityFeePerGas:ethers__WEBPACK_IMPORTED_MODULE_5__.gH.from(transaction.maxPriorityFeePerGas).toNumber(),paymaster:BigInt(pmDataResult.paymaster).toString(),nonce:ethers__WEBPACK_IMPORTED_MODULE_5__.gH.from(transaction.nonce).toNumber(),value:ethers__WEBPACK_IMPORTED_MODULE_5__.gH.from(transaction.value).toNumber(),data:transaction.data||"0x",factoryDeps:[],paymasterInput:ethers__WEBPACK_IMPORTED_MODULE_6__.arrayify(pmDataResult.paymasterInput)},signature=await this._signTypedData({name:"zkSync",version:"2",chainId:transaction.chainId},EIP712_TYPES,eip712tx),serializedTx=this.serialize(transaction,signature),zkSignedTx={from:transaction.from?.toString()||await this.getAddress(),to:transaction.to?.toString()||"",gas:transaction.gasLimit?.toString()||"",maxFeePerGas:transaction.maxFeePerGas?.toString()||"0",maxPriorityFeePerGas:transaction.maxPriorityFeePerGas?.toString()||"0",signedTransaction:serializedTx,paymaster:pmDataResult.paymaster},hash=(await(this.httpRpcClient?.zkBroadcastTransaction(zkSignedTx))).transactionHash;return await(this.provider?.getTransaction(hash))}serialize(transaction,signature){if(!transaction.customData&&113!==transaction.type)return ethers__WEBPACK_IMPORTED_MODULE_7__.serialize(transaction,signature);if(!transaction.chainId)throw Error("Transaction chainId isn't set!");function formatNumber(value,name){const result=ethers__WEBPACK_IMPORTED_MODULE_6__.stripZeros(ethers__WEBPACK_IMPORTED_MODULE_5__.gH.from(value).toHexString());if(result.length>32)throw new Error(`Invalid length for ${name}!`);return result}if(!transaction.from)throw new Error("Explicitly providing `from` field is required for EIP712 transactions!");const from=transaction.from,meta=transaction.customData??{},maxFeePerGas=transaction.maxFeePerGas||transaction.gasPrice||0,maxPriorityFeePerGas=transaction.maxPriorityFeePerGas||maxFeePerGas,fields=[formatNumber(transaction.nonce||0,"nonce"),formatNumber(maxPriorityFeePerGas,"maxPriorityFeePerGas"),formatNumber(maxFeePerGas,"maxFeePerGas"),formatNumber(transaction.gasLimit||0,"gasLimit"),transaction.to?ethers__WEBPACK_IMPORTED_MODULE_8__.getAddress(transaction.to):"0x",formatNumber(transaction.value||0,"value"),transaction.data||"0x"];if(signature){const sig=ethers__WEBPACK_IMPORTED_MODULE_6__.splitSignature(signature);fields.push(formatNumber(sig.recoveryParam,"recoveryParam")),fields.push(ethers__WEBPACK_IMPORTED_MODULE_6__.stripZeros(sig.r)),fields.push(ethers__WEBPACK_IMPORTED_MODULE_6__.stripZeros(sig.s))}else fields.push(formatNumber(transaction.chainId,"chainId")),fields.push("0x"),fields.push("0x");if(fields.push(formatNumber(transaction.chainId,"chainId")),fields.push(ethers__WEBPACK_IMPORTED_MODULE_8__.getAddress(from)),fields.push(formatNumber(meta.gasPerPubdata||5e4,"gasPerPubdata")),fields.push((meta.factoryDeps??[]).map((dep=>ethers__WEBPACK_IMPORTED_MODULE_6__.hexlify(dep)))),meta.customSignature&&0===ethers__WEBPACK_IMPORTED_MODULE_6__.arrayify(meta.customSignature).length)throw new Error("Empty signatures are not supported!");return fields.push(meta.customSignature||"0x"),meta.paymasterParams?fields.push([meta.paymasterParams.paymaster,ethers__WEBPACK_IMPORTED_MODULE_6__.hexlify(meta.paymasterParams.paymasterInput)]):fields.push([]),ethers__WEBPACK_IMPORTED_MODULE_6__.hexConcat([[113],ethers__WEBPACK_IMPORTED_MODULE_9__.encode(fields)])}}class ZkSyncConnector extends _connector_05689d68_browser_esm_js__WEBPACK_IMPORTED_MODULE_10__.C{constructor(config){super(),(0,_defineProperty_350fc508_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__._)(this,"chainId",1),this.config=config}async connect(args){if(this.personalWallet=args.personalWallet,this.chainId=await(await this.personalWallet.getSigner()).getChainId(),!await(0,_utils_f58e7acc_browser_esm_js__WEBPACK_IMPORTED_MODULE_12__.e)(this.chainId))throw new Error("Invalid zksync chain id");const bundlerUrl=this.config.bundlerUrl||`https://${this.chainId}.bundler.thirdweb.com`,entryPointAddress=this.config.entryPointAddress||_utils_f58e7acc_browser_esm_js__WEBPACK_IMPORTED_MODULE_12__.f;return this.httpRpcClient=new _http_rpc_client_0a079e80_browser_esm_js__WEBPACK_IMPORTED_MODULE_13__.H(bundlerUrl,entryPointAddress,this.chainId,this.config.clientId,this.config.secretKey),this.getAddress()}disconnect(){throw new Error("Method not implemented.")}async getAddress(){return(await this.getSigner()).getAddress()}async getSigner(){if(!this.personalWallet)throw new Error("Wallet not connected");return new ZkWrappedSigner(await this.personalWallet.getSigner(),this.httpRpcClient)}switchChain(chainId){throw new Error("Method not implemented.")}isConnected(){return Promise.resolve(!!this.personalWallet)}setupListeners(){throw new Error("Method not implemented.")}updateChains(chains){throw new Error("Method not implemented.")}async getProvider(){if(!this.getSigner())throw new Error("Personal wallet not connected");const signer=await this.getSigner();if(!signer.provider)throw new Error("Provider not found");return signer.provider}}}}]);