"use strict";(self.webpackChunkan_onchain_app_in_100_components=self.webpackChunkan_onchain_app_in_100_components||[]).push([[6048],{"./node_modules/@thirdweb-dev/sdk/dist/QueryParams-32a56510.browser.esm.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{D:()=>DEFAULT_QUERY_ALL_COUNT,F:()=>FALLBACK_METADATA,I:()=>InterfaceId_IERC721,a:()=>InterfaceId_IERC1155,b:()=>uploadOrExtractURI,c:()=>fetchTokenMetadataForContract,f:()=>fetchTokenMetadata,g:()=>getBaseUriFromBatch,u:()=>uploadOrExtractURIs});var _setErc20Allowance_7f76f677_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@thirdweb-dev/sdk/dist/setErc20Allowance-7f76f677.browser.esm.js"),ethers__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@ethersproject/bytes/lib.esm/index.js"),ethers__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@ethersproject/bignumber/lib.esm/bignumber.js"),ethers__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@ethersproject/contracts/lib.esm/index.js"),Buffer=__webpack_require__("./node_modules/buffer/index.js").Buffer,console=__webpack_require__("./node_modules/console-browserify/index.js");const InterfaceId_IERC721=(()=>ethers__WEBPACK_IMPORTED_MODULE_0__.arrayify("0x80ac58cd"))(),InterfaceId_IERC1155=(()=>ethers__WEBPACK_IMPORTED_MODULE_0__.arrayify("0xd9b67a26"))(),FALLBACK_METADATA={name:"Failed to load NFT metadata"};async function fetchTokenMetadata(tokenId,tokenUri,storage){if(tokenUri.startsWith("data:application/json;base64")&&void 0!==Buffer){const base64=tokenUri.split(",")[1],jsonMetadata=JSON.parse(Buffer.from(base64,"base64").toString("utf-8"));return _setErc20Allowance_7f76f677_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.a.parse({...jsonMetadata,id:ethers__WEBPACK_IMPORTED_MODULE_2__.gH.from(tokenId).toString(),uri:tokenUri})}const parsedUri=tokenUri.replace("{id}",ethers__WEBPACK_IMPORTED_MODULE_0__.hexZeroPad(ethers__WEBPACK_IMPORTED_MODULE_2__.gH.from(tokenId).toHexString(),32).slice(2));let jsonMetadata;try{jsonMetadata=await storage.downloadJSON(parsedUri)}catch(err){const unparsedTokenIdUri=tokenUri.replace("{id}",ethers__WEBPACK_IMPORTED_MODULE_2__.gH.from(tokenId).toString());try{jsonMetadata=await storage.downloadJSON(unparsedTokenIdUri)}catch(e){console.warn(`failed to get token metadata: ${JSON.stringify({tokenId:tokenId.toString(),tokenUri})} -- falling back to default metadata`),jsonMetadata=FALLBACK_METADATA}}return _setErc20Allowance_7f76f677_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.a.parse({...jsonMetadata,id:ethers__WEBPACK_IMPORTED_MODULE_2__.gH.from(tokenId).toString(),uri:tokenUri})}async function fetchTokenMetadataForContract(contractAddress,provider,tokenId,storage){let uri;const ERC165MetadataAbi=(await __webpack_require__.e(4811).then(__webpack_require__.t.bind(__webpack_require__,"./node_modules/@thirdweb-dev/contracts-js/dist/abis/IERC165.json",19))).default,erc165=new ethers__WEBPACK_IMPORTED_MODULE_3__.NZ(contractAddress,ERC165MetadataAbi,provider),[isERC721,isERC1155]=await Promise.all([erc165.supportsInterface(InterfaceId_IERC721),erc165.supportsInterface(InterfaceId_IERC1155)]);if(isERC721){const ERC721MetadataAbi=(await Promise.resolve().then(__webpack_require__.t.bind(__webpack_require__,"./node_modules/@thirdweb-dev/contracts-js/dist/abis/IERC721Metadata.json",19))).default,erc721=new ethers__WEBPACK_IMPORTED_MODULE_3__.NZ(contractAddress,ERC721MetadataAbi,provider);uri=await erc721.tokenURI(tokenId)}else{if(!isERC1155)throw Error("Contract must implement ERC 1155 or ERC 721.");{const ERC1155MetadataAbi=(await Promise.resolve().then(__webpack_require__.t.bind(__webpack_require__,"./node_modules/@thirdweb-dev/contracts-js/dist/abis/IERC1155Metadata.json",19))).default,erc1155=new ethers__WEBPACK_IMPORTED_MODULE_3__.NZ(contractAddress,ERC1155MetadataAbi,provider);uri=await erc1155.uri(tokenId)}}return uri?fetchTokenMetadata(tokenId,uri,storage):_setErc20Allowance_7f76f677_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.a.parse({...FALLBACK_METADATA,id:ethers__WEBPACK_IMPORTED_MODULE_2__.gH.from(tokenId).toString(),uri:""})}async function uploadOrExtractURI(metadata,storage){return"string"==typeof metadata?metadata:await storage.upload(_setErc20Allowance_7f76f677_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.C.parse(metadata))}async function uploadOrExtractURIs(metadatas,storage,startNumber,options){if(function isUriList(metadatas){return void 0===metadatas.find((m=>"string"!=typeof m))}(metadatas))return metadatas;if(function isMetadataList(metadatas){return void 0===metadatas.find((m=>"object"!=typeof m))}(metadatas)){return await storage.uploadBatch(metadatas.map((m=>_setErc20Allowance_7f76f677_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.C.parse(m))),{rewriteFileNames:{fileStartNumber:startNumber||0},onProgress:options?.onProgress})}throw new Error("NFT metadatas must all be of the same type (all URI or all NFTMetadataInput)")}function getBaseUriFromBatch(uris){const baseUri=uris[0].substring(0,uris[0].lastIndexOf("/"));for(let i=0;i<uris.length;i++){const uri=uris[i].substring(0,uris[i].lastIndexOf("/"));if(baseUri!==uri)throw new Error(`Can only create batches with the same base URI for every entry in the batch. Expected '${baseUri}' but got '${uri}'`)}return baseUri.replace(/\/$/,"")+"/"}const DEFAULT_QUERY_ALL_COUNT=100},"./node_modules/@thirdweb-dev/sdk/dist/contract-owner-49e75547.browser.esm.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{C:()=>ContractRoyalty,D:()=>DelayedReveal,a:()=>ContractOwner,c:()=>calculateClaimCost});var _contract_appuri_5c40af52_browser_esm_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@thirdweb-dev/sdk/dist/contract-appuri-5c40af52.browser.esm.js"),_transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@thirdweb-dev/sdk/dist/transactions-72f9603c.browser.esm.js"),_index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@thirdweb-dev/sdk/dist/index-33cd3415.browser.esm.js"),_fetchCurrencyValue_32d08b05_browser_esm_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@thirdweb-dev/sdk/dist/fetchCurrencyValue-32d08b05.browser.esm.js"),ethers__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@ethersproject/strings/lib.esm/utf8.js"),ethers__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@ethersproject/solidity/lib.esm/index.js"),ethers__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@ethersproject/abi/lib.esm/abi-coder.js"),ethers__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@ethersproject/bytes/lib.esm/index.js"),ethers__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/@ethersproject/bignumber/lib.esm/bignumber.js"),ethers__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./node_modules/@ethersproject/contracts/lib.esm/index.js"),_setErc20Allowance_7f76f677_browser_esm_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@thirdweb-dev/sdk/dist/setErc20Allowance-7f76f677.browser.esm.js"),_QueryParams_32a56510_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@thirdweb-dev/sdk/dist/QueryParams-32a56510.browser.esm.js"),_signature_d3ea643d_browser_esm_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./node_modules/@thirdweb-dev/sdk/dist/signature-d3ea643d.browser.esm.js"),_normalizePriceValue_9851c0eb_browser_esm_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./node_modules/@thirdweb-dev/sdk/dist/normalizePriceValue-9851c0eb.browser.esm.js");class ContractRoyalty{featureName=_index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_0__.d5.name;constructor(contractWrapper,metadata){this.contractWrapper=contractWrapper,this.metadata=metadata}async getDefaultRoyaltyInfo(){const[royaltyRecipient,royaltyBps]=await this.contractWrapper.read("getDefaultRoyaltyInfo",[]);return _index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_0__.bF.parseAsync({fee_recipient:royaltyRecipient,seller_fee_basis_points:royaltyBps})}async getTokenRoyaltyInfo(tokenId){const[royaltyRecipient,royaltyBps]=await this.contractWrapper.read("getRoyaltyInfoForToken",[tokenId]);return _index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_0__.bF.parseAsync({fee_recipient:royaltyRecipient,seller_fee_basis_points:royaltyBps})}setDefaultRoyaltyInfo=(0,_transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.f)((async royaltyData=>{const oldMetadata=await this.metadata.get(),mergedMetadata=await this.metadata.parseInputMetadata({...oldMetadata,...royaltyData}),contractURI=await this.metadata._parseAndUploadMetadata(mergedMetadata);if((0,_contract_appuri_5c40af52_browser_esm_js__WEBPACK_IMPORTED_MODULE_2__.h)("setContractURI",this.contractWrapper)){const contractEncoder=new _fetchCurrencyValue_32d08b05_browser_esm_js__WEBPACK_IMPORTED_MODULE_3__.C(this.contractWrapper),encoded=[contractEncoder.encode("setDefaultRoyaltyInfo",[mergedMetadata.fee_recipient,mergedMetadata.seller_fee_basis_points]),contractEncoder.encode("setContractURI",[contractURI])];return _transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"multicall",args:[encoded],parse:receipt=>({receipt,data:()=>this.getDefaultRoyaltyInfo()})})}throw new Error("Updating royalties requires implementing ContractMetadata in your contract to support marketplaces like OpenSea.")}));setTokenRoyaltyInfo=(0,_transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.f)((async(tokenId,royaltyData)=>{const parsedRoyaltyData=_index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_0__.bF.parse(royaltyData);return _transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"setRoyaltyInfoForToken",args:[tokenId,parsedRoyaltyData.fee_recipient,parsedRoyaltyData.seller_fee_basis_points],parse:receipt=>({receipt,data:()=>this.getDefaultRoyaltyInfo()})})}))}class DelayedReveal{constructor(contractWrapper,storage,featureName,nextTokenIdToMintFn){this.featureName=featureName,this.nextTokenIdToMintFn=nextTokenIdToMintFn,this.contractWrapper=contractWrapper,this.storage=storage}createDelayedRevealBatch=(0,_transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.f)((async(placeholder,metadatas,password,options)=>{if(!password)throw new Error("Password is required");const placeholderUris=await this.storage.uploadBatch([_setErc20Allowance_7f76f677_browser_esm_js__WEBPACK_IMPORTED_MODULE_4__.C.parse(placeholder)],{rewriteFileNames:{fileStartNumber:0}}),placeholderUri=(0,_QueryParams_32a56510_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.g)(placeholderUris),startFileNumber=await this.nextTokenIdToMintFn(),uris=await this.storage.uploadBatch(metadatas.map((m=>_setErc20Allowance_7f76f677_browser_esm_js__WEBPACK_IMPORTED_MODULE_4__.C.parse(m))),{onProgress:options?.onProgress,rewriteFileNames:{fileStartNumber:startFileNumber.toNumber()}}),baseUri=(0,_QueryParams_32a56510_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.g)(uris),baseUriId=await this.contractWrapper.read("getBaseURICount",[]),hashedPassword=await this.hashDelayRevealPassword(baseUriId,password),encryptedBaseUri=await this.contractWrapper.read("encryptDecrypt",[ethers__WEBPACK_IMPORTED_MODULE_6__.YW(baseUri),hashedPassword]);let data;if(await this.isLegacyContract())data=encryptedBaseUri;else{const chainId=await this.contractWrapper.getChainID(),provenanceHash=ethers__WEBPACK_IMPORTED_MODULE_7__.keccak256(["bytes","bytes","uint256"],[ethers__WEBPACK_IMPORTED_MODULE_6__.YW(baseUri),hashedPassword,chainId]);data=ethers__WEBPACK_IMPORTED_MODULE_8__.D.encode(["bytes","bytes32"],[encryptedBaseUri,provenanceHash])}return _transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"lazyMint",args:[uris.length,placeholderUri.endsWith("/")?placeholderUri:`${placeholderUri}/`,data],parse:receipt=>{const events=this.contractWrapper.parseLogs("TokensLazyMinted",receipt?.logs),startingIndex=events[0].args.startTokenId,endingIndex=events[0].args.endTokenId,results=[];for(let id=startingIndex;id.lte(endingIndex);id=id.add(1))results.push({id,receipt});return results}})}));reveal=(0,_transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.f)((async(batchId,password)=>{if(!password)throw new Error("Password is required");const key=await this.hashDelayRevealPassword(batchId,password);try{const decryptedUri=await this.contractWrapper.callStatic().reveal(batchId,key);if(!decryptedUri.includes("://")||!decryptedUri.endsWith("/"))throw new Error("invalid password")}catch(e){throw new Error("invalid password")}return _transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"reveal",args:[batchId,key]})}));async getBatchesToReveal(){const count=await this.contractWrapper.read("getBaseURICount",[]);if(count.isZero())return[];const countRangeArray=Array.from(Array(count.toNumber()).keys()),uriIndices=await Promise.all(countRangeArray.map((i=>{if((0,_contract_appuri_5c40af52_browser_esm_js__WEBPACK_IMPORTED_MODULE_2__.h)("getBatchIdAtIndex",this.contractWrapper))return this.contractWrapper.read("getBatchIdAtIndex",[i]);if((0,_contract_appuri_5c40af52_browser_esm_js__WEBPACK_IMPORTED_MODULE_2__.h)("baseURIIndices",this.contractWrapper))return this.contractWrapper.read("baseURIIndices",[i]);throw new Error("Contract does not have getBatchIdAtIndex or baseURIIndices.")}))),uriIndicesWithZeroStart=uriIndices.slice(0,uriIndices.length-1),tokenMetadatas=await Promise.all(Array.from([0,...uriIndicesWithZeroStart]).map((i=>this.getNftMetadata(i.toString())))),legacyContract=await this.isLegacyContract(),encryptedBaseUris=(await Promise.all(Array.from([...uriIndices]).map((i=>legacyContract?this.getLegacyEncryptedData(i):this.contractWrapper.read("encryptedData",[i]))))).map((data=>{if(ethers__WEBPACK_IMPORTED_MODULE_9__.hexDataLength(data)>0){if(legacyContract)return data;return ethers__WEBPACK_IMPORTED_MODULE_8__.D.decode(["bytes","bytes32"],data)[0]}return data}));return tokenMetadatas.map(((meta,index)=>({batchId:ethers__WEBPACK_IMPORTED_MODULE_10__.gH.from(index),batchUri:meta.uri,placeholderMetadata:meta}))).filter(((_,index)=>ethers__WEBPACK_IMPORTED_MODULE_9__.hexDataLength(encryptedBaseUris[index])>0))}async hashDelayRevealPassword(batchTokenIndex,password){const chainId=await this.contractWrapper.getChainID(),contractAddress=this.contractWrapper.address;return ethers__WEBPACK_IMPORTED_MODULE_7__.keccak256(["string","uint256","uint256","address"],[password,chainId,batchTokenIndex,contractAddress])}async getNftMetadata(tokenId){return(0,_QueryParams_32a56510_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.c)(this.contractWrapper.address,this.contractWrapper.getProvider(),tokenId,this.storage)}async isLegacyContract(){if((0,_contract_appuri_5c40af52_browser_esm_js__WEBPACK_IMPORTED_MODULE_2__.h)("contractVersion",this.contractWrapper))try{return await this.contractWrapper.read("contractVersion",[])<=2}catch(e){return!1}return!1}async getLegacyEncryptedData(index){const DeprecatedAbi=(await __webpack_require__.e(4601).then(__webpack_require__.t.bind(__webpack_require__,"./node_modules/@thirdweb-dev/contracts-js/dist/abis/IDelayedRevealDeprecated.json",19))).default,legacy=new ethers__WEBPACK_IMPORTED_MODULE_11__.NZ(this.contractWrapper.address,DeprecatedAbi,this.contractWrapper.getProvider()),result=await legacy.functions.encryptedBaseURI(index);return result.length>0?result[0]:"0x"}}async function calculateClaimCost(contractWrapper,pricePerToken,quantity,currencyAddress,checkERC20Allowance){let overrides={};const currency=currencyAddress||_index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_0__.aV,totalCost=(await(0,_normalizePriceValue_9851c0eb_browser_esm_js__WEBPACK_IMPORTED_MODULE_12__.n)(contractWrapper.getProvider(),pricePerToken,currency)).mul(quantity);return totalCost.gt(0)&&(currency===_index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_0__.aV?overrides={value:totalCost}:currency!==_index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_0__.aV&&checkERC20Allowance&&await(0,_signature_d3ea643d_browser_esm_js__WEBPACK_IMPORTED_MODULE_13__.a)(contractWrapper,currency,totalCost,quantity,0)),overrides}class ContractOwner{featureName=_index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_0__.d6.name;constructor(contractWrapper){this.contractWrapper=contractWrapper}async get(){return this.contractWrapper.read("owner",[])}set=(0,_transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.f)((async address=>{const resolvedAddress=await(0,_index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_0__.aL)(address);return _transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:"setOwner",args:[resolvedAddress]})}))}}}]);